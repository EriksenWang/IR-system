{
    "title": "An Empirical BSSRDF Model",
    "publication_date": "1982",
    "authors": [
        {
            "full_name": "Craig Donner",
            "firstname": "Craig",
            "lastname": "Donner",
            "affiliations": [
                {
                    "organization": "Columbia University † University of Virginia ‡ UC Berkeley § UC",
                    "address": {
                        "city": "San Diego"
                    }
                }
            ]
        },
        {
            "full_name": "Jason Lawrence",
            "firstname": "Jason",
            "lastname": "Lawrence",
            "affiliations": [
                {
                    "organization": "Columbia University † University of Virginia ‡ UC Berkeley § UC",
                    "address": {
                        "city": "San Diego"
                    }
                }
            ]
        },
        {
            "full_name": "Ravi Ramamoorthi",
            "firstname": "Ravi",
            "lastname": "Ramamoorthi",
            "affiliations": [
                {
                    "organization": "Columbia University † University of Virginia ‡ UC Berkeley § UC",
                    "address": {
                        "city": "San Diego"
                    }
                }
            ]
        },
        {
            "full_name": "Toshiya Hachisuka",
            "firstname": "Toshiya",
            "lastname": "Hachisuka",
            "affiliations": [
                {
                    "organization": "Columbia University † University of Virginia ‡ UC Berkeley § UC",
                    "address": {
                        "city": "San Diego"
                    }
                }
            ]
        },
        {
            "full_name": "Henrik Wann Jensen",
            "firstname": "Henrik Wann",
            "lastname": "Jensen",
            "affiliations": [
                {
                    "organization": "Columbia University † University of Virginia ‡ UC Berkeley § UC",
                    "address": {
                        "city": "San Diego"
                    }
                }
            ]
        },
        {
            "full_name": "Shree Nayar",
            "firstname": "Shree",
            "lastname": "Nayar",
            "affiliations": [
                {
                    "organization": "Columbia University † University of Virginia ‡ UC Berkeley § UC",
                    "address": {
                        "city": "San Diego"
                    }
                }
            ]
        },
        {
            "full_name": "Monte Carlo Path",
            "firstname": "Monte Carlo",
            "lastname": "Path",
            "affiliations": [
                {
                    "organization": "Columbia University † University of Virginia ‡ UC Berkeley § UC",
                    "address": {
                        "city": "San Diego"
                    }
                }
            ]
        }
    ],
    "abstract": "Diffusion Dipole + Single Scattering (10 min)\nOur Model + Single Scattering (30 min) Single Scattering Only\nFigure\n1\n: Although the appearance of orange juice is dominated by low-order scattering events, it is not accurately predicted by a single scattering model alone (lower right). Adding the contribution from high-order multiple scattering using the diffusion dipole (left) still fails to capture these effects and produces visible color artifacts. Numerical methods such as Monte Carlo path tracing (upper right) or photon mapping are accurate, but do not provide an explicit model of the BSSRDF and require long rendering times. Our proposed model is compact, efficient to render and can accurately express the complex spatial-and directionally-dependent appearance of these types of materials.",
    "full_text": "Light propagates into and scatters within all non-metallic materials. This subsurface scattering is common in many liquids-such as orange juice, coffee or milk, and in solids-such as gemstones, leaves, wax, plastics and skin. It gives materials their characteristic colors, and provides a soft, translucent appearance. Accurate and compact models of the way light interacts with these materials are necessary to efficiently render them.\n\nLight scattering in translucent materials is described by the bidirectional scattering surface reflectance distribution function S (the BSSRDF [Nicodemus et al. 1977]). The BSSRDF defines the general transport of light between two points and directions as the ratio of the radiance L o ( x o , ω o ) exiting at position x o in direction ω o to the radiant flux Φ i ( x i , ω i ) incident at x i from direction ω i :\n\nwhere S depends on the optical properties of the material-the scattering and absorption coefficients σ s and σ a , the relative index of refraction η, and g ∈ [-1 : 1] which parameterizes the anisotropy of the phase function.\n\nNumerical techniques such as Monte Carlo path tracing [Kajiya 1986;Jensen et al. 1999] are capable of simulating general BSS-RDFs. However, these methods are expensive, often requiring hours to days of processing. Scattering equations may also be used in this context [Pharr and Hanrahan 2000], but are computationally expensive to evaluate. Photon mapping [Jensen 1996] can render many BSSRDFs but becomes expensive in both time and space for highly scattering materials. Furthermore, these techniques do not explicitly model the BSSRDF. Rather, determining the fraction of light that is transported between any pair of points requires a complete simulation.\n\nA related set of techniques focus on simulating participating media (see Cerezo et al. [2005] for a survey), though many have difficulty handling refraction at an interface. In particular, Premoze et al. [2003] use an approximate path integral formulation to identify the most probable paths of light through a medium to efficiently render a wide range of scattering materials. More similar to our work, Premoze et al. [2004] analyze light transport in materials based on Monte Carlo simulations. They use the path integral technique to compute the contribution of collimated beams by first precomputing the reduced intensity within the scattering volume, and blurring this response using gaussian point spread functions to approximate the spatial and angular spread of light. As before, these methods do not give an explicit representation of the BSSRDF which is the focus of this paper.\n\nExisting analytic models of the BSSRDF only apply to two classes of materials. When light scatters exactly once and at a single point, this single scattering has a closed-form analytic solution [Blinn 1982;Hanrahan and Krueger 1993]. Such models produce highly directional effects since the exitant light is assumed to be scattered directly from propagating beams of light. At the other end of the spectrum are highly scattering materials. The BSSRDF in these cases is often modeled as the superposition of a single scattering term and a diffuse term [Jensen et al. 2001]. This diffusion approximation [Stam 1995] is common and can be applied on its own to materials that have negligible low-order scattering [Jensen and Buhler 2002;Donner and Jensen 2005]. However, this approximation assumes light is scattered isotropically and produces incorrect predictions when low-order scattering is significant, such as in materials like orange juice (see Figure 1). These materials exhibit significant absorption of the light as it propagates through the material, so much of the energy is scattered back into the environment near the point of incidence. This light exits in areas and directions outside of the single scattering regime, but not in the high-order multiple scattering regime. As a result, the angular distribution of exitant light is not predicted well by single scattering, diffusion, or their sum.\n\nHybrid methods attempt to combine the simplicity of diffusion with the accuracy of general numerical techniques. Donner and Jensen [2007] introduce a method to model asymmetric diffuse reflectance by sampling beams of light using diffusion sources seeded by single-step photon tracing. This method assumes that the material is highly scattering and neglects near-source and directional effects. Li et al. [2005] couple path tracing with the diffusion approximation for long path lengths, but in materials with moderate scattering or non-trivial absorption the path tracing step becomes computationally intensive. Furthermore, since these methods rely on numerical simulation, they too fail to provide an explicit model of the BSSRDF.\n\nMeasuring the appearance of translucent materials is also a difficult task. Goesele et al. [2004], Tong et al. [2005], and Peers et al. [2006] measure point-to-point transport, but ignore the angular distribution of the exitant light. Also, their data is only suitable for reproducing the particular materials measured. Narasimhan et al. [2006] use dilution to measure the optical properties of a variety of scattering materials, but rely on general numerical techniques for rendering. Instead of measuring a range of materials, we opt to simulate them instead and derive an analytic model based on these simulations. In this regard, our approach is similar to the virtual gonioreflectometry technique of Westin et al. [1992] for analyzing the reflectance of complex opaque surfaces. Bouthors et al. [2008] adopted a similar empirical approach to ours to study the light transport within slabs of clouds using simulations that assume a fixed albedo and phase function. They propose a set of analytic functions to model the aggregate reflectance observed in these simulations, which allows efficiently rendering clouds with arbitrary shapes. Although we also use a large-scale Monte Carlo simulation to study the internal scattering of materials, we propose an explicit representation of the full BSSRDF that characterizes the transport between arbitrary pairs of surface locations over a large range of materials, and considers refraction at the material boundary.\n\nWe propose an analytic model of the BSSRDF that applies to a wide range of materials. Our model is phenomenological and derived from a large-scale simulation of the subsurface light transport for a range of optical properties and geometric configurations. Although our approach was inspired by data-driven reflectance models [Ward 1992;Dana et al. 1999;Matusik et al. 2003], our choice to simulate these effects avoids a difficult acquisition task and provides greater control over the materials we consider. Further, we validate our simulation and final model using measured data.\n\nAlthough the full BSSRDF in Equation 1 is a 12D function (4 spatial parameters, 4 angular parameters and 4 optical parameters), we make the common assumption of a spatially uniform, homogeneous semi-infinite material. This reduces the dimensionality of the BSSRDF to 8D (discussed in the next section) and makes exploring this space more feasible. 1 We use an efficient photon tracing technique and a cluster of computers to reconstruct the 2D hemispherical distribution of exitant light over a dense sampling of the remaining geometric and optical variables (a 6D space). This dataset captures the complete spatial and angular appearance of a wide range of translucent materials. Although this required many months of processing, it only needs to be created once and is an important contribution of this work.\n\nBased on an analysis of this simulated data, we propose an analytic function expressed in elliptic coordinates with six fit parameters that accurately captures the features of these hemispherical distribution functions. We demonstrate that this function fits the simulated data well and, in turn, agrees with measured data, including highly scattering materials such as milk and wax which exhibit clear nondiffuse and anisotropic behaviors. Importantly, the parameters of this function vary smoothly over the 6D space of remaining geometric and optical parameters. This allows tabulating and interpolating them away from the samples we considered in our simulation to provide a continuous representation of the full BSSRDF. Our final model consists of a table of parameter settings of this elliptic function (approx. 250MB of space, though in practice only a fraction of the data is needed at one time) that can be used directly for rendering. We present images rendered using this model that show complex directional effects such as glows around beams that would be impossible to render with existing diffusion-based techniques.\n\nWe used a Monte Carlo photon tracing algorithm to reconstruct slices of the BSSRDF. Similar to Hanrahan and Krueger [1993], we trace photons into a semi-infinite slab and record how much energy they deposit at the surface. We discretize the hemisphere of outgoing light based on the exit trajectory of the photons. This requires significantly more photons and storage than a standard diffuse trace.\n\nAssumptions and Parameterization: Recall that we assume a homogeneous, semi-infinite material which allows reducing the 12D BSSRDF in Equation 1 to an 8D function. Table 1 summarizes our notation and the geometry of our setup is illustrated in Figure 2.\n\nSince the scattering and absorption coefficients σ s and σ a have infinite range, we choose to parameterize the BSSRDF in terms of the albedo α = σ s /(σ s + σ a ). Note that α ∈ [0..1]. All materials with the same albedo have the same exitant response up to a distance scale which is determined by the mean free path length ℓ = 1/(σ s + σ a ). For example, two materials with optical coefficients (σ s , σ a ) and (2σ s , 2σ a ) differ only in terms of ℓ and ℓ/2. Although technically there is a chance a photon may exit the material at any distance from the incident beam, overall exitant intensity falls-off rapidly with increasing distance from the source. Therefore, we can consider only the local region around x i without missing a significant portion of the BSSRDF. These choices allow replacing the optical properties (σ s , σ a , g, η) with (α, g, η) and provide a finite usable range for all parameters that is suitable for sampling.\n\nJust as with isotropic BRDFs, we assume that the angular dependence of the BSSRDF depends on only 3 variables (θ i , θ o , φ o ). Similarly, for a homogeneous BSSRDF the amount of light exchanged between two surface points x i and x o depends only on their relative positions. This allows parameterization of the spatial dimensions using 2D polar coordinates with the angle θ s and radial distance r = || x ox i ||. Note that r is measured in mean free path lengths.\n\nUnder the above assumptions, we simplify the BSSRDF as:\n\n(2) We next describe a photon tracing algorithm for reconstructing slices of this form of the BSSRDF. In Section 4 we introduce our new BSSRDF model.\n\nOur photon tracing algorithm relies on sampling the probable paths of light within a material. We discretize the exitant direction of each photon at the surface and accumulate its power into bins. However, to accurately resolve the complete hemispherical distribution of outgoing light a large number (∼10 12 ) of photons are required, particularly in the case of strong anisotropic scattering (i.e., |g| > 0.5).\n\nFigure 2: Geometric setup for our simulation and model. A collimated beam of light arriving at point x i from direction ω i (shown in red) makes angle θ i with the surface normal. A photon from this beam that arrives at point x p propagating in direction ω p has an exitant trajectory d towards the point x o = (r, θ s ) on the surface. This particular photon path exits the material in direction ω o = (θ o , φ o ). We emit photons along a collimated beam incident on the slab from directionω i , such that it makes angle θ i with the surface normal n (see Figure 2). These photons refract into the material and propagate a distance d before being scattered or absorbed:\n\nwhere ξ ∈ [0..1] is a uniformly distributed random number.\n\nReusing Photon Paths: To reduce the number of photons traced, and thus increase the speed of our simulation, we compute the power Φ e that a photon propagating in direction ω p incident on position x p would contribute at the surface point x o , if it were scattered directly there (see Figure 2):\n\nwhere Φ p is the power of the photon at\n\n|| xo-xp|| is the normalized vector from x p to x o , p is the phase function, and F t is the Fresnel transmittance at the surface. If internal reflection occurs,foot_1 then the photon makes no contribution. Otherwise, Φ e is added to the exitant radiance at x o . We compute the contribution of each photon path to every exitant point we consider during our simulation. This results in a consistent estimate of the exitant radiance. To normalize the final radiance values, the power of each photon is scaled by the inverse of the number of photons traced. 90 -75 -60 -45 -30 -15 0 15 30 45 60 75  A diffusion approximation predicts a flat, diffuse response over the camera angle, whereas our simulated data and model agree well with measurements. We approximated the optical properties of milk as σ s = 1.165, σ a = 0.0007 (α ∼ 0.99, ℓ = 0.86mm), g = 0.7, η = 1.35 [Joshi et al. 2006], and of wax as\n\nVariance Reduction: We use Russian Roulette to determine whether this photon, having just traveled the distance d, is scattered or absorbed. If it is scattered, then we compute its new trajectory by importance sampling the Henyey-Greenstein phase function [Jensen 2001]. Therefore, we do not modify the weight or power of a photon unless it probabilistically reaches the surface, at which point it is internally reflected after having applied the Fresnel term. We continue to trace each photon until it is absorbed.\n\nOur photon tracing algorithm allows simulating the full 8D BSS-RDF in Equation 2 to construct a database we will use to develop and validate our model. To accurately resolve near-source and directional effects, we densely sample the 2D exitant hemisphere (θ o , φ o ) at ∼ 6200 uniformly distributed directions at each exitant location (r, θ s ) on the surface. Since the response of a material type does not depend on the the mean free path length ℓ, we fix ℓ = 1mm in all of our simulations. During rendering, we account for the true mean free path length of a specific material by simply applying the appropriate scale factor (Section 5). We sample the remaining BSSRDF dimensions as follows:\n\n15, 30, 45, 60, 70, 80, 88} r ∈ {.01, .05, .1, .2, .4, .6, .8, 1, 2, 4, 8, 10}| 15,30,45,60,75,90,105,120,135,150,165, 180} α ∈ {0.01, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 0.99} g ∈ {-0.9, -0.7, -0.5, -0.3, 0, 0.3, 0.5, 0.7, 0.9, 0.95, 0.99} η ∈ {1, 1.1, 1.2, 1.3, 1.4} Note that r, the distance in mean free paths from the incident beam, increases at an exponential rate to account for the fact that the total exitant intensity diminishes along a similar trend. The other patterns provide a mostly uniform sampling of the remaining dimensions. Note that we sample this space more finely near extremely low and high albedo and for very high forward scattering.\n\nThese sampling patterns produce about 750, 000 exitant hemispheres, for a total of ∼ 4.7 × 10 9 points in this 8D space. Generating this amount of data poses a significant challenge since obtaining acceptable noise levels for just one hemispherical slice can require many hours of processing time. We performed these simulations on 15 Dual-Socket Quad-Core 2.33GHz Intel R Xeon R machines, for a total of 120 processing cores. Reconstructing the exitant hemi-spherical distribution for a single set of optical properties requires about 60MB of storage-the entire database is roughly 36GB.\n\nTo verify the accuracy of our simulation and the model we propose in Section 3, we measured the distribution of exitant light for two materials: diluted milk and wax. These materials were illuminated using a red (635nm) laser dot of diameter ∼ 1mm at a fixed angle of θ i = 20 • and were imaged using a monochromatic QImaging Retiga 4000R camera with a 60mm lens attached to a motorized gantry with an angular precision of ∼ 0.01 • . We moved the camera along an arc at a fixed stand-off distance of 1.5m from the sample and recorded a high-dynamic range image every 5 • over the range\n\nThis set of images provides 1D angular slices of the exitant hemispherical distributions for many points on the material surface. We repeated this procedure for two arcs: one parallel to the plane of incident light and one perpendicular to this plane. The camera was photometrically calibrated and the resulting images were aligned using standard chart-based calibration techniques [Zhang 1999].\n\nFigure 3 compares measured slices of the exitant light to predictions made by our simulation (Section 2.1), a standard diffusion approximation [Jensen et al. 2001] and our proposed model (we discuss the \"Model Fit\" curves in Section 4.1). Note that due to the angles involved in the measurement, the plane of single scattering was explicitly excluded. The optical properties we used in these simulations are reported in the caption. Note that because the diffusion approximation predicts a diffuse response, modulated only by Fresnel transmittance, it does not capture the clear asymmetry in these distributions. Our simulation closely follows the measured data. At these distances from the source there is some visible noise in the simulations as the paths are relatively long for high-albedo materials. Unfortunately, since the size of the laser dot is large relative to the mean free path of these materials, it was difficult to obtain accurate measurements very close to the source. Although these plots show only two configurations of r and θ s , they are representative of the close agreement we observed over the entire material surface.\n\n1 0.5 0 -0.5 -1 y d -1 -0.5 0 0.5 1 x d θ i = 30 • θ s = 0 • r = 4 mfp α = 0.6 g = 0 η = 1.3 RMS error = 9.3 × 10 -6 m -2 sr -1 1 0.8 0.6 0.4 0.2 0\n\nSimulated Distribution Model Fit The left column lists the optical properties (α, g, η), the geometric setup (θ i , r, θ s ), and the RMS error of the fit. The second column contains diagrams that show the incident beam in solid red, the propagating beam inside the material in dashed red, and the simulated distribution of the exitant radiance. The last two columns show false-color plots of these hemispherical distributions projected onto the disc according to Equation 5. The \"Simulated Distribution\" plots were produced with our photon tracing algorithm and the \"Model Fit\" plots correspond to our proposed analytic model. To aid comparison, all plots are normalized to unity. The single scattering plane ŝ is shown in the cases where the lobe is symmetric about this plane. Note that all of these distributions, except for (e), exhibit this type of symmetry while (e) is symmetric about the plane formed by x ix o and the surface normal n.\n\nThe simulation method described previously produces 2D slices of the BSSRDF S(θ i , r, θ s , θ o , φ o |α, g, η) over outgoing angles θ o and φ o . In this section we describe a number of key observations about these functions that will serve as the basis of our model presented in Section 4. Specifically, we are interested in understanding how these hemispherical functions vary with respect to the optical properties α, g, and η, along with their dependence on the incident angle of the beam θ i and surface position (r, θ s ).\n\nFigure 4 visualizes several hemispherical slices produced by our simulation at different parameter settings. The leftmost column lists the optical properties, geometric configuration, and RMS error of our fits (described in the next section). Next to these values is a 3D visualization of the simulated exitant light, along with the incident beam (in red) and the path it takes into the material after being refracted at the surface (dashed red). The single scattering plane ŝ is also shown. This plane traces an arc across the exitant hemisphere, and is shown as a wedge emanating from the refracted beam. Because the overall intensity of outgoing light is proportional to the distance from the surface location x o these plots are normalized for visualization purposes. These types of visualizations are helpful in understanding how the shapes of these distributions are related to the angular configuration of the setup, and reveal important symmetries in the data.\n\nThe third column in Figure 4 shows projections of these hemispherical functions onto the unit disc. The color scale, shown at right, assigns higher intensity values red and lower values blue-this same scheme is used in the 3D plots as well. We map the hemisphere to the unit disc using a standard projection:\n\nThe variety of shapes present in these 2D distributions indicates a complex relationship with the remaining parameters of the BSS-RDF. Furthermore, the presence of high-frequency features in these distributions means that they would not be suitable for rendering directly. Linearly combining these slices in order to interpolate regions of the BSSRDF domain that were not directly simulated would produce significant errors. This motivates our goal of providing a compact analytic function that captures the shape of these distributions. Interpolating the parameters of this analytic function provides a reliable and efficient way of modeling the continuous 8D BSSRDF domain.\n\nBased on this collection of simulated data we make the following key observations:\n\nAnisotropy: The exitant distribution of light is not diffuse. We observe that even highly scattering materials, such as in Figure 4b, exhibit a non-diffuse and anisotropic shape. This follows from the fact that as light is scattered away from the propagating beam of light it is focused near the single scattering plane. Therefore, the majority of the exitant energy is due to low-order scattering events that occur before photons have lost much of their directionality.\n\nPeak Direction and Kurtosis: With a few exceptions discussed in Section 7, these distributions almost always contain a single peaked lobe. We also observe that the direction of this peak depends on θ i . We attribute this to the fact that at steeper angles more photons propagate a further distance across the surface than below the surface before being scattered. The shape of this lobe also depends on the surface position (r, θ s ) since points near ŝ will receive a higher contribution of light. Additionally, the optical properties of the material clearly affect the shape of these exitant lobes. Higher values of α produce more scattering and thus a wider lobe. With larger magnitudes of g, however, light is less likely to scatter outside the direction of the propagating beam and thus produces a tighter, sharper peak. This was especially true for forward scattering materials such as Figure 4c. Finally, since the direction of propagation of the beam depends on η, it also affects the orientation of the lobe.\n\nLobe Asymmetry: These lobes are typically not rotationally symmetric about their axes and the degree of asymmetry depends primarily on the angle θ s . As photons propagate into the material near the refracted beam and then scatter away towards the surface, points on the surface receive the strongest contribution from regions near the propagating beam. The distributions at exitant points further away from the propagating beam exhibit greater asymmetries since the photons contributing to these locations have traveled a greater distance. This asymmetry is particularly visible in Figure 4b.\n\nLobe Shape: The lobe is often aligned with the single scattering plane ŝ, as in Figure 4a-d, indicating a strong contribution from loworder scattering. However, when the single scattering trajectory exceeds the critical angle (i.e. when d • n > sin -1 η), total internal reflection occurs and produces lobes with a wider, less peaked shape, but ones that are still not entirely diffuse. This is visible in Figure 4e. Here, the exitant lobe tends to be symmetric about the plane aligned with θ s , as shown.\n\nElliptical to Circular Isocontours: The black isocontour lines shown in Figure 4 reveal that these lobes have an elliptical shape near the peak which transitions to a more circular shape further away from the peak. We attribute this to the number of times light was scattered by the material before arriving at these different exitant directions. Light that exits near ŝ has likely only scattered two or three times giving the exitant distribution a sharp elliptical contour along the projection of the propagating beam onto the hemisphere. Photons that travel longer paths contribute less power and are likely to exit in more uniform directions, resulting in a more diffuse distribution with circular contours.\n\nOur goal is to model the 2D distribution of exitant light of the BSS-RDF over the possible range of geometric and optical parameters.\n\nThe observations made in the previous section indicate that functions traditionally used to model BRDFs, such as cosine or Gaussian lobes, are not applicable in this case. Because these lobes also tend to be sharply peaked, generic basis functions such as spherical or zonal harmonics are also unsuitable. Note that in this section, parameters to our empirical function are in bold; vectors are indicated with hats or arrows.\n\nIndeed, the shape, position and size of the dominant lobe of exitant light has a complex relationship with the underlying optical and geometric properties. An important observation, however, is that cross-sectional contours of these lobes change from elliptical to circular away from the peak direction. This motivates our choice to define a function for these lobes in elliptic coordinates (µ, ν) [Korn and Korn 2000]. This coordinate system defines a set of confocal ellipses that have high eccentricity near the origin and slowly become more circular further away (see Figure 5).\n\nThe coordinates µ and ν are related to (x d , y d ), the projection of ω o onto the unit disc given in Equation 5, according to: Although a + , a -, b + and b -are typically equal, allowing them to vary independently provides greater control over the shape of a lobe defined with respect to these coordinates. Note that when µ = 0, a + and a -define the distances of the elliptical focal points from the origin.\n\nIsocontours and Alignment: Elliptic coordinates are well suited for capturing the \"elliptical-to-circular\" trend we observed in our simulations. Considering the projection of these slices onto the disc, we place the origin of this coordinate system at the peak direction ω peak (location of maximum exitant intensity) and define the x-axis to lie along the plane of symmetry ŝp . This plane is either the single scattering plane ŝ, or the plane defined by x ix o and the surface normal n for distributions dominated by internal reflection as previously discussed. We propose the following analytic function of these 2D exitant distributions:\n\nwhere F t is the Fresnel transmittance in the outgoing direction ω o , χ = x 2 d + y 2 d is the distance on the unit disc from the origin ω peak , k s is the overall scale of the distribution, defined such that the fit intensity matches the data at ω peak , and Γ = {a + , a -, b + , b -, k e , k c } is a 6D vector that collects the free parameters in this function. These control the lobe's shape, degree of asymmetry, anisotropy and kurtosis as explained below.\n\nAsymmetry and Anisotropy: The parameters a + , a -, b + , and b -determine the asymmetry of the elliptical contours. When they are small, the lobe is focused; as they increase, the lobe becomes more diffuse. When they are unequal, the lobe is asymmetric and anisotropic.\n\nLobe Shape: The parameters k e and k c determine the shape of the cross-section of the lobe (i.e., capturing the transition from elliptical to circular). The parameter k e controlls the falloff along the plane of symmetry ŝp . Distributions with long, high peaks have lower k e , while tightly focused peaks require larger values. The radially symmetric shape is determined by k c . Although these parameters are correlated to one another, especially further from the peak direction, maintaining these degrees of freedom provides finer control over the precise shape of the lobe near ω peak , where most of the exitant light is focused.\n\nWe fit the six parameters in Γ to 2D slices produced by our simulation for each configuration of the optical and geometry properties using direct analysis. We found that general non-linear optimization routines were unnecessarily complex and often produced noisy fits which undermines our goal of smoothly interpolating these values over the full BSSRDF domain.\n\nOur fitting procedure is iterative. We first record values of the exitant distribution along a set of isocontour levels, e.g. c 1 = 10%, c 2 = 20%, . . . , c 8 = 80%, and c 9 = 90% of the peak value. For simplicity, we only examine points along the x d -axis as this simplifies the relationship between cartesian and elliptic coordinates (since ν = 0 when y d = 0):\n\nAt each contour sample, we calculate µ using Equation 9. The values of x d at these samples are readily obtained. More than two samples results in an overconstrained linear system computed by partially inverting Equation 8:\n\nWe solve this system to obtain values of k e and k c that best fit these contour samples in the least squares sense. We repeat this procedure along the positive and negative sides of the x d -axis, and retain the smaller of the two values for both k e and k c .\n\nGiven these values for k e and k c it is straightforward to solve for a ± and b ± from Equation 10. For example, for x ± d :\n\nThe expression for y ± d is similar. We solve for these values at each contour level, and choose the set of a ± and b ± which minimizes the total L 2 error over the hemisphere with respect to the original exitant distribution. We then re-estimate k e and k c using these new values of the other parameters and repeat this process ten times or until we observe the error change by less than 1%.\n\nFor each slice of the BSSRDF computed in our simulation we store the best fit parameters of our model H in a large table, a total of ∼ 250MB. 3 Because the two dimensions of ω o are the most densely sampled in our simulation this is a significant reduction, from ∼ 6200 points on the hemisphere to the set of inputs to H (11 values). Finally, note that in practice only a fraction of this data is used at any one time during rendering. Path Tracing Our Model Photon Diffusion Diffusion Dipole Figure 6: A beam of light striking the material surface at a 60 • angle off the normal. The leftmost image was rendered using path tracing, and shows the expected glow around the propagating beam. The image rendered using our model closely agrees to the reference path-traced result. Both photon diffusion and the diffusion dipole incorrectly predict the angular distribution of energy within this material as well as the spectral distribution of emitted light.\n\ncaptures the basic trends in these distributions over a wide range of optical properties and geometric configurations. In particular, note that H exhibits the characteristic \"elliptical-to-circular\" pattern.\n\nWe also computed the RMS error of our fits over the entire collection of simulated data. These errors have a mean of 3.2 × 10 -3 and standard deviation of 9.0 × 10 -4 . Note that these values have the same units as the BSSRDF of [m -2 sr -1 ]. The RMS error of the fits shown in Figure 5 from (a) to (e) are 9.3 × 10 -6 , 1.3 × 10 -3 , 4.2 × 10 -6 , 3.6 × 10 -6 , and 4.0 × 10 -5 , respectively. We also validated the process of interpolating the parameters of H to predict exitant distributions that were not directly simulated. We computed the RMS error between each simulated distribution and that produced by interpolating the parameters of our model using those values at its nearest neighbors. This is akin to a \"leave one out\" cross validation test. These errors had a mean of 4.9 × 10 -4 with a standard deviation of 6.9 × 10 -7 . We conclude that our model is capable of fitting individual slices with a high degree of numerical accuracy and that its parameters can be safely interpolated to reconstruct a continuous representation of the BSSRDF over the range of geometric and optical properties considered in our simulations.\n\nAs further validation of our model and to compare it to alternative methods, we produced renderings of a beam of light entering a material with α = (0.07, 0.53, 0.52) and g = 0 (see Figure 6). Although all four rendering methods capture single scattering well, both the diffusion dipole and photon diffusion inaccurately predict the color and intensity of multiply scattered light. Our method, on the other hand, captures the correct wavelength-dependence along with the directional effects of the internally scattered light.\n\nWe sample the illumination incident on translucent materials using standard techniques (e.g. [Jensen et al. 2001]). To compute a set of surface locations with respect to a single shade point, we draw samples from a probability density function proportional to the exitant diffuse distribution based on the scale factor k s in H. Alternatively, we could use a hierarchical point-based approximation of the irradiance [Jensen and Buhler 2002] to perform this sampling. This would decrease rendering times without affecting the model itself.\n\nInterpolation: We first reconstruct the BSSRDF that corresponds to the optical properties of the material we are interested in rendering. We linearly interpolate the parameters of H based on the closest neighboring points along the α, g, and η axes. This gives a compact (∼ 100KB) 3D reconstruction defined over θ i , r, and θ s .\n\nFor a shade point x o and lit point x i on the surface we compute r and θ s with respect to an orthogonal coordinate system with x-axis along X = ω i -( ω i • n i ) n i . The surface normal at x i is n i which we assume points up and the z-axis of this coordinate system is defined as Z = X × n i . This construction leaves θ s as the rotation:\n\nTo determine the interpolated locations along the r dimension we compute the distance in terms of mean free paths by scaling by the inverse of the mfp length, i.e. σ s + σ a .\n\nHandling Non-Planar Geometry: Once we have interpolated the parameters of our elliptic function as described above, we next determine the values of θ o and φ o to use when evaluating H. Because our model is only valid for semi-infinite materials, care must be taken when rendering arbitrary geometry (Section 7).\n\nWe define a separate coordinate system anchored at x o using the normal n o , Xh = n o × Z and Zh = Xh × n o , and derive θ o , φ o as:\n\nUsing these values, we locate the nearest 8 points in the 3D dataset, and interpolate the values of the model parameters ( ω peak , ŝp , k s | Γ ). Finally, we calculate the value of the BSSRDF by evaluating H in Equation 8 using these interpolated values.\n\nAll of the results in this paper were rendered on an Intel R Xeon R 2.33GHz Quad-Core processor and those produced with our model required less than one hour of processing time.\n\nFigure 1 compares renderings of orange juice produced using our method to those produced with Monte Carlo path tracing and the diffusion dipole combined with a single scattering term [Jensen et al. 2001].\n\nWe used parameters σ s = (0.071, 0.1, 0.042), σ a = (0.093, 0.16, 1.15), g = 0.9, and η = 1.3, which produces a relatively low spectral albedo of α = (0.43, 0.38, 0.035). Since orange juice is highly forward scattering, simulating single scattering alone does not capture its true appearance. High-order multiple scattering is also not a dominant effect and the image rendered using the diffusion dipole is too dark. This is because the dipole model assumes that anisotropic scattering is balanced by many scattering events. However, the low albedo (i.e. high absorption) of this material causes most of the light to be absorbed before reaching this regime. Because our model (center) more accurately captures these low order scattering events, it matches the reference path traced image, but requires significantly less time to compute.\n\nFigure 7 shows a green lozenge with significant translucency. This material has a spectral albedo of α = (0.16, 0.27, 0.15) and is forward scattering with g = 0.5. The scene has global illumination which can be seen in the bleeding of green light from the lozenge onto the ground plane. With our model, it is possible to efficiently render a much larger range of translucent materials than previously possible, even in scenes with global illumination.\n\nTo demonstrate the generality of our model we rendered the image shown in Figure 8 which combines several of the materials measured by Narasimhan et al. [2006]. These materials have significant absorption and anisotropic scattering which make them impossible to render correctly using standard diffusion-based techniques. The total amount of data required to render this image was about 300KB, as each material requires about 100KB for rendering.\n\nOur analytic formula of the exitant distribution of light H did fail to capture the proper response for some of the materials we observed. In particular, materials with strongly anisotropic backscattering (g 0) can produce two exitant lobes (Figure 9). One is due to low-order scattering and is in the expected direction, but the other is caused by higher-order scattering. Clearly, as our model consists of only a single lobe it cannot handle these cases. However, because most real-world materials are forward scattering we concentrated on modeling the more prominent lobe and leave these cases for future study.\n\nWhen light arrives at the surface along grazing angles internal refraction becomes more prevalent and our model is less accurate. Also, our assumption of a semi-infinite and flat surface overestimates the exitant light corners and thin geometric features. This limitation is shared by previous work based on the diffusion dipole. Though in Section 5 we describe an approximate method for constructing a local coordinate frame based on the incident and exitant points on the surface, this method is not well-suited for optically thin materials, and does not account for the changes in internal scattering due to curved or cornered geometry. In the future we intend to investigate how best to overcome this limitation, such as using additional simulations similar to Bouthers et al. [2008]. The geometry has a significant influence on the appearance, and fur-Monte Carlo Path Tracing (100 hours) Our Model + Single Scattering (50 minutes)\n\nHead & Shoulders Espresso Era\n\nFigure 8: Renderings using parameters from [Narasimhan et al. 2006] to show that our model is capable of simulating a diverse range of materials. ther investigation is needed to study precisely how local geometry affects the scattering of light, particularly in this regime of midalbedo materials.\n\nFurther research is also warranted to determine a simpler relationship between the optical and geometric properties of the BSSRDF and the parameters in the analytic function H. While our own preliminary work in this direction has indicated that this mapping is complex and non-linear, developing an analytic relationship would shed further light on this important class of functions and increase the efficiency and accuracy of simulating these types of materials.\n\nWe presented an empirical model of the BSSRDF that is valid over a far wider range of angular configurations and material properties than existing analytic models. Our model captures both nearsource and directional effects including the important contribution of low-order scattering. This model was derived from a large-scale simulation of the hemispherical distribution of light leaving a material's surface over a range of positions from the source, incident angles and underlying optical properties (scattering and absorption coefficients, phase function, and index of refraction). We presented an analytic function to approximate these hemispherical functions which is expressed in elliptic coordinates and has six parameters. We estimated the best-fitting parameters for our simulated data. Because these parameters vary smoothly with respect to the remaining degrees of freedom they may be interpolated between simulated locations to provide a compact yet continuous representation over the full BSSRDF domain. This allows generating realistic images of translucent materials with notoriously difficult optical proper-ties. In particular, many of the results we reported would have been impossible to render using diffusion based methods and much less efficient with more general numerical integration techniques.\n\nd Projection of ω o onto unit disc ν,µ Elliptic coordinates of (x d ,y d ) ω peak Direction of maximum exitant intensity ŝp Plane of symmetry of exitant distribution H Proposed analytic distribution function a ± ,b ± Focal points in elliptic coordinate system k s , k e , k c Parameters in analytic distribution function\n\nAs we assume the material is homogeneous, for any fixed set of optical parameters, the function that is evaluated during rendering is only 3D.\n\nInternal reflection occurs when the exitant trajectory of the photon (relative to the normal) is greater than the critical angle: d • n o > sin -1 η, where n o is the surface normal at x o and η is the ratio of the indices of refraction. Note that sin -1 η is the critical angle, and η < 1 from the point of view of the photon.\n\nThis data can be downloaded, along with the raw simulated data and the measurements used in Figure3, as auxiliary material from the ACM Digital Library at http://portal.acm.org."
}