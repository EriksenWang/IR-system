{
    "title": "Radio Frequency Direct-Digital QPSK Modulators in CMOS Technology by",
    "publication_date": "2007-09",
    "authors": [
        {
            "full_name": "Ahmed M El-Gabaly",
            "firstname": "Ahmed M",
            "lastname": "El-Gabaly",
            "affiliations": [
                {
                    "organization": "Master of Science (Engineering) Queen's University Kingston",
                    "address": {
                        "country": "Canada"
                    }
                }
            ]
        }
    ],
    "abstract": "In this thesis, novel direct-digital Quadrature Phase Shift Keying (QPSK) modulators are proposed in low-cost Complimentary Metal Oxide Semiconductor (CMOS) technology for radio frequency (RF) wireless applications. Direct-digital architectures have attracted much attention recently as they potentially offer significant cost savings and performance benefits. A new direct-digital QPSK modulator concept is introduced where the carrier is modulated directly by digital data using Pass-Transistor Logic (PTL) circuits for a small size and low power consumption. The concept is demonstrated through the design of an L-band modulator followed by an enhanced tunable S-band version.\nThe proposed L-band modulator first generates all four quadrature phases of the carrier by using a 90° resistor-capacitor, capacitor-resistor (RC-CR) phase shifter followed by two 180° active baluns. One signal from the in-phase components and another from the quadrature-phase components are later selected by two PTL circuits according to the in-phase (I) and quadrature-phase (Q) digital data respectively. Finally the chosen signals are subtracted by a differential amplifier. The circuit has been experimentally demonstrated in a standard 0.18µm CMOS process, showing good performance at 1.7GHz with the data transmission rate and carrier rejection exceeding 20Mbps and 40dB respectively. The integrated circuit (IC) measures only 425µm by 850µm and consumes less than 43mW of power.",
    "full_text": "Table of Contents  Table 3.1: Summary of measured characteristics of L-band QPSK modulator................\n\nTable 4.1: Summary of measured characteristics of S-band QPSK modulator.............. Table 4.2: Comparison of the S-band QPSK modulator with other work. .....................                           List of Figures and Illustrations x                    xi Figure 4.16: Real part of the simulated impedance looking in from port 1......................  4.17: Plot of transmission coefficient phase for phase imbalance at 2.4GHz. ...... Figure 4.18: Plot of transmission coefficient magnitude for amplitude imbalance..........\n\nIntermediate Frequency ISI Intersymbol Interference LC Inductor-Capacitor LNA Low Noise Amplifier LO Local Oscillator MEMS Microelectromechanical Systems NF Noise Figure NRZ Non-Return-to-Zero PA Power Amplifier PRBS Pseudo-Random Binary Sequence PSK Phase Shift Keying PTL Pass-Transistor Logic Q Quadrature-phase QAM Quadrature Amplitude Modulation QPSK Quadrature Phase Shift Keying RC Resistor-Capacitor RC-CR Resistor-Capacitor, Capacitor-Resistor RF Radio Frequency SoC System-on-Chip SPDT Single-Pole Double-Throw TSMC Taiwan Semiconductor Manufacturing Company WLAN Wireless Local Area Network µ n Electron mobility A RF RF carrier amplitude A v Voltage conversion gain BW Null-to-null bandwidth C Capacitance C cb Channel-to-body capacitance C gc Gate-to-channel capacitance C gd Gate-to-drain capacitance C gs Gate-to-source capacitance C jdb Drain-body junction capacitance C jsb Source-body junction capacitance C ov Overlap capacitance C ox Gate oxide capacitance per unit area E/N Energy to noise ratio E s Symbol energy E sat Velocity saturation electric field f MOD Modulation frequency G Amplitude ratio g m Transconductance I D Bias current I DS Drain-to-source current L Inductance L FET length List of Abbreviations and Symbols xv L D Diffusion overlap length L eff Effective channel length Q Quality factor R Resistance R b Bit rate R bias Biasing resistance R d Drain resistor R DS Switch on-resistance R G Gate resistor R L Load resistance R NET Net switch on-resistance R s Source resistor T Time period T b Bit period V - Negative voltage V + Positive voltage V DD Supply voltage V DS Drain-to-source voltage V GS Gate-to-source voltage V I In-phase voltage V in Input voltage V LO LO voltage signal V out Output voltage List of Abbreviations and Symbols xvi V Q Quadrature-phase voltage V QPSK QPSK output signal V RL Voltage across load resistance V T Threshold voltage V TUNE Tuning Voltage W FET width Z 0 System impedance Z in Input impedance θ Phase difference λ Wavelength ω c Cutoff frequency Chapter 1 Introduction 1.1 General Introduction The demand for light and low-power wireless communications devices such as cellular phones, Wireless Local Area Networks (WLAN) and Global Positioning Systems The highly competitive market of personal communication products drives manufacturers to constantly reduce costs. One possible solution is to integrate the RF front-end including the PA, LNA and up-and down-converters with digital circuits on the same chip. Not only does this reduce cost, but reliability and power consumption are also improved compared to using discrete components. Complimentary Metal Oxide Semiconductors (CMOS) has been the mainstream technology for digital circuits since the 1970s [1]. With continuous technology scaling and decreasing transistor gate length over time, CMOS has become a feasible means for analog applications extending to the millimeter-wave frequency range [2], [3]. Thus it is naturally suited for implementing monolithic system-on-chip (SoC) transceivers. However, as both digital and analog/RF portions of the transceiver are being closely packed on the same Integrated Circuit (IC), new device and circuit structures are needed [4]. High-speed digital communications have flourished over the last few decades with modern wireless systems (e.g. IEEE 802.11a/g/n WLANs) employing complex vector modulation such as Quadrature Phase Shift Keying (QPSK) and Quadrature Amplitude Modulation (QAM) for increased bandwidth and spectrum efficiency. Such modulation schemes have been traditionally implemented using heterodyne modulators since it was difficult to design direct-digital RF modulators with adequate modulation accuracy for low bit error rates (BER) and reliable data transmission. However continuous scaling and developments in monolithic technologies such as CMOS make it now possible to realize direct-digital modulators with improved performance in terms of conversion efficiency and data throughput, potentially leading to new wireless standards in the future [5]. Direct-digital modulators have attracted much attention recently due to their significant advantages over their traditional heterodyne counterparts. Several components in the heterodyne architecture are not needed in a direct modulator including the intermediate frequency (IF) oscillator, IF bandpass filter and the RF upconverter.\n\nThis greatly reduces the size of the system and facilitates integration with existing digital CMOS circuits. In addition, higher data transmission rates are possible since the modulation bandwidth is no longer limited by a relatively low IF frequency, as in heterodyne systems. However, having said that, direct-digital modulators and transmitters suffer from one important drawback: corruption of the carrier local oscillator (LO) by the power amplifier (PA) output through a mechanism widely known as \"injection pulling\" or \"injection locking\". Such a problem can be alleviated nevertheless by various shielding techniques to isolate the carrier LO or by offsetting the LO frequency [6].\n\nIn this thesis, novel direct-digital QPSK modulators are proposed with new RF components and circuits devised in low-cost CMOS technology. A new direct-digital QPSK modulator concept is introduced where the carrier is modulated directly by digital data using Pass-Transistor Logic (PTL) circuits. The main advantage of this approach is its relative simplicity in terms of size and power consumption compared to most other direct-digital QPSK modulators. The concept is demonstrated through the design of an L-band modulator that we first published in [7] followed by an enhanced tunable S-band version showing very good performance with high data transmission rates. These modulators offer compact yet effective solutions enabling high-speed and low-power data transmission for portable wireless applications. In particular:\n\n• The L-band modulator circuit is experimentally demonstrated in 0.18µm CMOS process, showing good performance at 1.7GHz with the data transmission rate and carrier rejection exceeding 20Mbps and 40dB respectively. The IC measures only 425µm by 850µm and consumes less than 43mW from a 1.8V supply.\n\n• The enhanced S-band modulator is also demonstrated in 0.18µm CMOS process showing very good performance at 2.4GHz. An accurate QPSK signal constellation was achieved after tuning the circuit, with the phase and amplitude errors being less than 1.4° and 0.3dB respectively. The supported data rates go well beyond 56Mbps, while the carrier rejection achieved is more than 32dB. The IC measures 720µm by 888µm with an active area of only 505µm by 610µm, and consumes less than 33mW from a 1.8V supply.\n\nThe thesis is organized as follows:\n\nChapter 2 explores direct-digital modulation and its benefits over traditional heterodyne architectures. It also reviews the QPSK modulation scheme, outlining its main characteristics such as signal constellation and power spectral density. A literature review of recently published work on direct QPSK modulators is performed next. As the performance of a direct quadrature modulator strongly depends on the accuracy of obtaining a 90° phase shift, commonly reported techniques to design an accurate 90° phase shifter are studied. Finally, widely used methods for modulating the quadrature carriers are discussed with a summary of their advantages and drawbacks.\n\nChapter 3 introduces and discusses the new QPSK modulator concept. It later describes the design of an L-band direct-digital QPSK modulator in CMOS that demonstrates this new concept. The components involved are analyzed in detail while stressing their important design considerations. This includes an investigation of commonly used circuit techniques for implementing the baluns and summing junctions required by the modulator, followed by the design of new circuits applicable to our needs.\n\nThe chapter concludes with simulations and measurement results of the fabricated IC.\n\nAn enhanced version of the direct-digital QPSK modulator for S-band applications is presented in Chapter 4. Modified circuit designs to achieve tunable operation and a more compact size are described. Finally, simulation and experimental results of the S-band modulator indicating improved performance over the original modulator are presented and discussed.\n\nChapter 5 concludes the thesis with a summary of the performance features and benefits offered by the proposed QPSK modulator architecture. Recommendations for additional enhancements and feature extensions of the modulators are also given for future work.\n\nLiterature Review\n\nThis chapter explores two modulator architectures widely used in digital wireless transmission, namely heterodyne and direct-digital modulators, demonstrating the benefits of the latter. A general background on common digital modulation techniques including Quadrature Phase Shift Keying (QPSK) is also given. Ultimately, a literature review of recently published work on direct QPSK modulators is performed, evaluating common techniques to generate quadrature carriers and discussing conventional methods used for mixing.\n\nIn heterodyne modulators, digital data is converted in two (or more) steps to the desired RF signal for transmission as shown in Figure 2.1. The data first undergoes modulation at a lower IF frequency before its upconverted to the RF frequency. This is usually performed in a quadrature fashion by mixing 90° out-of-phase IF carriers with inphase (I) and quadrature-phase (Q) data channels to suppress the undesired sideband.\n\nThe resulting IF signal is then filtered to remove spurious harmonics generated by the mixers. The modulated IF signal is later upconverted to an RF signal using another mixer and filtered to remove the unwanted sideband and spurious harmonics. Because simple upconversion generates the wanted and unwanted sidebands with equal magnitudes, the bandpass filter (BPF) must reject the unwanted sideband by a large factor, typically 50 to 60dB [6]. Such stringent specifications at high frequencies require a high quality (Q) filter, which is usually passive, off-chip and expensive. The RF signal is then boosted to the needed power level by a power amplifier (PA) and finally filtered to remove out-ofband components resulting from the nonlinearities of the PA. In contrast, direct-digital modulators convert digital data directly to the desired RF frequency as shown in Figure 2.2. Data is both modulated and upconverted to an RF signal in the same quadrature modulator. A filter then removes harmonics generated by the mixers before amplification as in the heterodyne case. This simplifies the transmitter considerably, requiring no IF filters, RF upconverters and only one local oscillator (LO).\n\nUltimately, the size and power consumption of the system are significantly reduced.\n\nFurthermore, filtering requirements and nonlinearities associated with the second upconversion stage are no longer present, facilitating IC integration to reduce costs and improving the system's dynamic range. Finally, as modulation occurs at a high RF frequency as opposed to a low IF frequency, more modulation bandwidth is available for higher data rates. Despite the various advantages mentioned above, direct-digital transmitters suffer from one important drawback: disturbance of the RF local oscillator (LO) by the power amplifier (PA) [6]. This issue arises because the PA output is a modulated waveform with a high signal power and a spectrum centered around the LO frequency. As illustrated in Figure 2.3 [8], the \"noisy\" output of the PA could leak to the local oscillator through parasitic coupling in the IC and corrupt the oscillator's spectrum. This usually occurs through a mechanism called \"injection pulling\" where the LO frequency tends to shift towards the noise frequency and eventually locks to it as the noise level increases.\n\nSuch a process is illustrated in Figure 2.4 [8]. Nevertheless, various shielding techniques exist to isolate the LO and alleviate this problem such as buffering the LO output, placing guard rings around the LO [9], [10] and keeping the PA off-chip [11]. A more effective approach is to offset the LO frequency by a significant factor (typically a half) so that it is sufficiently far away from the PA output spectrum. This is usually achieved by mixing the LO signal with another oscillator signal and then filtering the result, or by using subharmonic mixing techniques [8].\n\nIn digital communications, the modulating wave usually consists of non-return-tozero (NRZ) binary encoded data while the carrier is a continuous-wave (CW) sinusoid.\n\nTo distinguish one data value from the next a step change in the amplitude, frequency, or phase of the carrier is made. In the more general case of M-ary signaling, 2 m distinct steps are needed to represent m bits of data sent at a time. The result of this process is Amplitude Shift Keying (ASK), Frequency Shift Keying (FSK) and Phase Shift Keying (PSK) respectively which are illustrated in Figure 2.5 [12]. As PSK and FSK modulated signals ideally have constant envelopes, they are less sensitive to amplitude nonlinearities in the transmitter's power amplifier (PA) that lead to spectral spreading [6], relaxing the PA's linearity requirements for higher power efficiency. For this reason, they are used much more widely than ASK in a variety of RF applications, including cellular phones, WLANs and GPS. There are many different possible types of PSK and FSK modulation available, each providing tradeoffs in quality, bandwidth, power efficiency and hardware complexity. Therefore, we will focus only on two popular PSK schemes that are relevant for this thesis, namely binary and quadrature PSK.\n\nBinary Phase Shift Keying (BPSK) modulation is a special case of the general Mary phase shift keying with M = 2. In particular, the binary data selects one of the two opposite phases of the carrier. Shown in Figure 2.6 [12], the modulated signal can be written mathematically as:\n\nwhere A RF is the amplitude and ω RF is the angular frequency of the RF carrier. The phase shift φ(t) is given by:\n\nwith i = 0 or 1 corresponding to the binary data value. This is equivalent to writing:\n\nwhere B(t) represents the input bit stream with a value of -A RF for logic 0 and +A RF for logic 1. Therefore, a BPSK system is characterized by a signal constellation that is onedimensional with two message points at ±A RF as shown in Figure 2.7 [13]. A block diagram of the simplest BPSK modulator is also shown in Figure 2.8, where the NRZ digital data and the carrier signal enter a mixer with the generated output being the desired BPSK signal. The power spectrum of a BPSK signal for random input binary data with logic 0 and 1 equally likely and the values transmitted in different time slots being statistically independent is known to have a sinc squared shape centered around the carrier frequency [13]. This is mainly due to employing rectangular pulses for the binary waveform in time domain, generating a wide sinc response in frequency domain. Mathematically, the power spectral density S BPSK (ω) of a BPSK signal is [6]:\n\nwhere T b is the bit period. This power spectrum falls off as the inverse of square of frequency as illustrated in Figure 2.9 [14]. From the plot, the power spectrum features a main lobe bounded by well-defined nulls. The width of this main lobe is referred to as the null-to-null bandwidth and is found to be twice the bit rate R b :\n\nAs the null-to-null bandwidth encompasses the dominant lobe of the spectrum, it contains most of the BPSK signal energy. In fact, it can be shown that it carries more than 90% of the total energy [14].   An important goal in the design of an RF communication system is the efficient use of the frequency spectrum to arrive at the narrowest channel bandwidth for a given data rate. This is especially critical for limited-bandwidth applications in crowded frequency bands such as WLANs. Quadrature-carrier multiplexing systems have proven to be effective for this purpose [6] [13]. In such systems, the input binary data stream is divided into two separate streams that modulate a pair of quadrature carriers. The modulated output signals are then combined before transmission. A widely used example of this is Quadrature Phase Shift Keying (QPSK), which is the next level up from BPSK.\n\nIn QPSK, the binary data stream is subdivided into pairs of two bits or dibits each constituting a symbol. One of four equally spaced phases of the carrier, such as 45°, 135°, 225° and 315°, is then selected according to the symbol value. The modulated signal is shown in Figure 2. 10 [13] and can be written mathematically as:\n\nwhere the phase shift φ(t) is given by:\n\nwith i = 0, 1, 2, 3 corresponding to a unique symbol value. This is equivalent to writing:\n\nwhere I(t) and Q(t) represent the in-phase (I) and quadrature-phase (Q) bit streams in time with a value of -A RF /√2 for logic 0 and +A RF /√2 for logic 1. It is important to note that the arithmetic operation in (2.8) is merely inconsequential, i.e. either an addition or subtraction can be chosen as long as it is performed using complex vector arithmetic.\n\nTherefore, a QPSK system is characterized by a signal constellation that is twodimensional with four message points as shown in Figure 2.11 [13]. A block diagram of the simplest QPSK modulator is also shown in Figure 2.12 where I and Q NRZ digital signals are mixed with quadrature phases of the carrier and then summed at the output.\n\nSince a QPSK signal can be seen as the summation of two BPSK signals in quadrature, its power spectrum is similar to that of its BPSK constituents. However, for the same overall data rate, the QPSK symbol (dibit) rate only needs to be half of the BPSK bit rate. Thus the power spectral density S QPSK (ω) of a QPSK signal can be derived from (2.4) by substituting 2T b for T b [6]:\n\n(2.9)\n\nThis power spectrum has the same sinc squared shape as in Figure 2.9 and is plotted separately in Figure 2.13 [14] below. The null-to-null bandwidth of the main lobe is found to be the bit rate R b :\n\nwhich is half of that shown in Figure 2.9 for BPSK. Therefore QPSK requires only half the bandwidth of BPSK for the same data rate. It should be pointed out that this significant improvement in bandwidth efficiency comes at the relatively small cost of increased hardware complexity as shown in Figures 2.8 and 2.12. In addition, as illustrated in Figures 2.7 and 2.11, there are more adjacent points in the signal constellation for QPSK than BPSK with a smaller minimum distance between them, suggesting a higher probability of error in the presence of noise which adversely affects the system's quality. However, a more careful analysis reveals that the symbol energy (E s ) in QPSK given by [6]:\n\nis twice as large as the bit energy in BPSK. With this observation it can be proved that BPSK and QPSK have approximately the same probability of error especially at higher energy to noise (E/N) ratios [13].    In our treatment of BPSK and QPSK modulators, we have assumed that the data bits were represented by time-limited rectangular pulses which gave rise to sinc shaped frequency spectra extending out to infinity as shown in Figures 2.9 and 2.13. It is therefore important to discuss methods to limit the width of the generated spectrum to reduce interference with neighboring channels in crowded frequency bands. In practice, the transmitter includes a few bandwidth-limiting components such as lowpass and bandpass filters that serve towards this goal. However, such filtering attenuates and delays the high and low frequency components differently, dispersing the rectangular pulse and extending its duration beyond the allocated period [13]. Therefore when a sequence of symbols is transmitted through the system the dispersed pulses will interfere with each other leading to a destructive phenomenon called intersymbol interference (ISI) as shown in Figure 2.14 [6]. This increases the probability of error especially when transmitting random data in narrowband channels, further degrading the system's quality.\n\nTo mitigate this problem, different pulse-shaping techniques can be used for the digital data to sharply reduce its spectrum content beyond the specified channel. A sinc shaped pulse is ideally suited for this purpose according to Nyquist's theorem, but due to practical difficulties in its implementation a raised-cosine shape is usually used [8] [13].\n\nThere are several direct-digital QPSK modulator designs that have been developed over time with different circuit topologies for each component in Figure 2.12, particularly the 90° phase shifter and modulating mixer. In this section, the most common circuits will be discussed with their advantages and limitations to give an overview of the various alternatives available in the design of QPSK modulators.\n\nThe performance of any direct-conversion quadrature modulator including its signal constellation accuracy, bit error rate (BER) and modulation bandwidth depends highly on the accuracy of generating quadrature carriers. For this reason, several techniques have been designed to generate accurate 90º phase shifters with low amplitude and phase errors [15]. These include: 1) frequency divide-by-two circuits [16]- [18]; 2) microwave distributed couplers [19]- [22]; 3) resistor-capacitor (RC) all-pass filters [23],\n\n[24]; 4) resistor-capacitor, capacitor-resistor (RC-CR) networks [25]- [27]; 5) inductorcapacitor (LC) high and low pass filters [28], [29]; and 6) RC polyphase filters [30]- [34].\n\nIn frequency divide-by-two circuits (DTCs), two latches are cascaded in a negative feedback loop to form a master-slave flip-flop with each stage exhibiting a 90° phase shift for the required loop total of 180°, as shown in Figure 2.15 [6]. The outputs of the latches are thus in quadrature but only when the inputs are precisely complementary and the two latches match perfectly. In practice, device mismatches result in phase imbalances and additional imbalances occur as the input differential signals are not exactly 180° out of phase especially at high frequencies. Despite efforts for overcoming these problems to generate an accurate 90° phase shift, the latches usually consume a significant amount of DC power. In addition, generating an oscillator signal at twice the frequency could entail more DC power or might be impractical altogether if the desired LO frequency is very high, for example 60GHz [6]. Microwave distributed networks such as the branch-line, Lange and parallel line couplers that use planar transmission lines (e.g. microstrip or coplanar waveguides) can provide a very precise 90° phase shift over a wide band of frequencies [20], [21]. They are also well established and can be readily designed with excellent model-to-hardware correlation [22], [35]. However, they tend to be prohibitively large for monolithic IC integration especially at lower RF and microwave frequencies where the wavelength is on the order of centimeters. For this reason, they are not often used in IC designs and will not be further discussed here.\n\nRC all-pass phase shifters consist of a pair of RC networks and differential amplifiers with component values chosen to yield a transfer function that has constant magnitude for all frequencies, i.e. an all-pass response. Figure 2.16 [23] below is an example of an RC all-pass phase shifter. The relative RC time constants between the two networks are designed in such a manner that the phase difference between their output signals is 90° at the center frequency [24]. Second and higher order RC networks (Figure 2.16) are usually employed to achieve this 90° phase shift over a broader range of frequencies. An interesting property of these networks is that most of the design parameters depend on ratios between component values as opposed to their absolute values [23]. This makes them less sensitive to process variations, albeit the centre frequency still shifts with any change in component value.\n\nWhile the broadband performance of RC all-pass filters is a definite plus, they are particularly large and complicated to design [24]. RC-CR networks shown in Figure 2.17 [6] provide a simple technique to shift the signal by ±45°. The phase difference between the two outputs is 90° for all frequencies which is desirable, but the amplitudes are equal only at the cutoff frequency ω = 1/(RC),\n\nwhere R and C are the resistor and capacitor values. Therefore, the phase difference is not sensitive to process variations but the amplitude match certainly is. If the value of either R or C changes, so does the frequency at which equal-magnitude signals exist [6]. Much effort has been made to achieve an amplitude match over a wide frequency range by using limiters (e.g. differential amplifiers), but several stages need to be cascaded which consumes a lot of DC power, diminishing the main advantage of RC-CR networks [25], [36]. As depicted in Figure 2.17, the circuit is entirely passive and therefore consumes zero DC power, a definite plus in portable low-power applications. Nevertheless careful circuit and device layout techniques, such as common-centroid layout for example, are available to reduce component mismatch and tolerances for satisfactory model-tohardware correlation. Furthermore, an additional design cycle may be used to adjust the performance if deemed feasible. LC high and lowpass filters (Figure 2.18 [28]) also provide a simple method to shift the signal by ±45° and are similar to RC-CR networks with the resistors essentially replaced by inductors. Doing so provides a lower signal loss than RC-CR networks but at the cost of significantly increased footprint, possibly reaching prohibitive levels for monolithic integration. For this reason, they are not widely used as the other alternatives. An RC polyphase filter is a symmetric RC network with inputs and outputs connected in relative phases as shown in Figure 2.19 [31] below. Each RC (CR) branch leads to a -45° (+45°) phase shift at the cutoff frequency of 1/(RC). Therefore the differential inputs are shifted ±45° towards each other at this cutoff frequency and combined at the outputs (with 0dB gain) to form the differential quadrature signals. The RC polyphase network can be viewed as low-pass (RC) and high-pass (CR) filter sections connected together at the outputs, with their low and high pass frequency responses combining together for an overall all-pass response. Thus, in contrast to the RC-CR network, a 90° phase difference only appears at the cut-off frequency 1/(RC) while the amplitudes are matched irrespective of frequency. A result of this is that the phase difference is now sensitive to process variations and the frequency at which quadrature signals exist will shift if the value of R or C changes. Most efforts to counter this problem have focused on cascading several stagger-tuned stages of the polyphase filter whose cut-off frequencies are logarithmically spaced out for a wideband equiripple response [31]- [34]. Doing so gives rise to a large footprint and possibly substantial signal loss as each stage loads the previous one. Careful circuit and device layout techniques, such as common-centroid layout for example, may nonetheless by used to reduce component mismatch and tolerances for satisfactory predictability. Furthermore, an additional design cycle may be employed to adjust the performance if possible.\n\nThere are many ways to implement the mixers shown in Figure 2.12 for QPSK modulation, each providing tradeoffs in performance such as conversion gain, linearity, noise, port-to-port isolation and input matching.\n\nThe Gilbert cell [37] is a very common mixer architecture that lends itself particularly well to monolithic integration and has several advantages including high conversion gain, high port-to-port isolation and spurious signal cancellation due to its double-balanced structure. ) is preferable, as the increasing reactance of an inductor with increasing frequency also helps to attenuate high frequency harmonic and intermodulation components [38]. A drawback of using inductors of course is the additional area consumed on-chip, which increases the cost of the IC. Another possible technique is to remove the tail current source and connect the source terminals of M1 and M2 to ground, either directly or through degeneration as in Figure 2.22 [36]. Not only does this relax the supply voltage headroom, but it also eliminates interaction between the two devices through their once common source node, which reduces third-order non-linearities and associated intermodulation products [39].   The power consumption of the Gilbert cell can be somewhat high depending on the biasing conditions required for the desired performance. Since the Gilbert cell has at least two stacked levels of transistors, its use with a low supply voltage can be quite challenging as the tradeoff between gain and linearity becomes problematic. This can be quantified by writing a simple expression for the voltage conversion gain (A v ) as [40]:\n\nwhere g m is the transconductance of M1-M2, R L is the output load resistance, I D is the bias current, V GS -V T is the gate-source overdrive voltage of M1-M2, and V RL is the voltage drop across the load resistors R L . This clearly depicts the tradeoff between gain (g m R D ) and linearity (V GS -V T ) for limited voltage headroom (V RL ). With a fixed supply voltage depending on the technology node, low-power Gilbert mixer design has focused on decreasing the bias current while keeping the same gain and linearity [41]. The transistor widths are decreased in proportion to keep their gate overdrive (V GS -V T ) and linearity intact. As the transconductance is now rather low due to the small gate width and current, the output load resistance is also increased to achieve the same voltage conversion gain.\n\nThe noise figure (NF) of Gilbert cell mixers can be somewhat high as there are at least six active devices contributing noise, as well as possibly four or more resistors. One noise source is definitely the transconductor pair with its NF establishing a lower bound on the overall mixer NF [38]. This may be computed readily using the same approach as calculating the NF of a low noise amplifier (LNA) [38], [42]. The switching cores also degrade the noise performance in a number of ways. In practice, the switches are lossy and have poor isolation, which attenuates the signal current and increases the NF.\n\nAnother NF contribution arises from the interval of time in which both switches are simultaneously on for part of the LO period. During this time the two transistors amplify and inject their noise (thermal gate resistance and channel noise) to the output. To minimize this, large LO signals are employed to make the switches switch practically instantaneously, which is becoming more and more of a challenge as the supply voltage is reduced. In contrast to the transconductor noise, the noise contributed by the switches is usually difficult to calculate, as their operation is time-variant with frequency translation present [6]. Nevertheless, practical Gilbert mixers generally exhibit a noise figure of around 15dB or more.\n\nFinally, the input impedance to a Gilbert cell mixer is relatively high and predominantly imaginary due to the small capacitance presented by the gates of the FET, which is far from being matched to the system's real impedance (50Ω standard). Thus a matching network is typically required that can be implemented on-chip using inductors and/or capacitors. A potential problem with this is that the matching network may occupy a very large area, increasing the cost of the IC considerably. Another solution would be to implement the matching network off-chip using packaged lumped elements or distributed networks with transmission lines. This requires taking the signal off-chip and then back on which often results in losses along with added noise.\n\nWhile active mixers such as the Gilbert cell are most commonly used for their high conversion gain and port-to-port isolation, passive mixers may also be realized with other attractive properties such as small IC footprint and zero DC power consumption. In   The passive mixer of Figure 2.24 generally has a high linearity [43] if the transistors experience a large gate-to-source overdrive voltage in the on state so that their on-resistance does not vary significantly with the input voltage. This can be quantified by writing the following expression for the switch's on-resistance R DS , which will be discussed in more detail in later chapters as well:\n\nwhere µ n is the electron mobility, C ox is the gate oxide capacitance per unit area, W and L are the width and length of the FET, V GS is the gate-to-source voltage and V T is the threshold voltage. The applied gate-to-source voltage V GS is equal to the difference between the local oscillator (V LO ) and input (V IN ) voltages in this case:\n\nEquation (2.14) clearly shows that the on-resistance R DS is inversely proportional to the gate-to-source overdrive voltage (V LO -V IN -V T ), with only small variations in its value at large voltage levels. This linearity advantage may diminish however as the voltage is scaled down with technology generation. As illustrated in Figure 2.25 using a sinusoidal LO signal V LO , the switch gate-to-source overdrive voltage can be relatively small over a considerable part of the LO period. Therefore, the input voltage V IN varies the switches' on-resistance significantly during this time, introducing nonlinear distortion [36]. The noise figure (NF) of passive CMOS mixers can be relatively low (∼10dB), at least when compared to that of Gilbert cell mixers [44]. This is because the need for a transconductance stage is eliminated in the passive mixer, which usually sets a lower bound on the overall Gilbert cell mixer NF. The noise contributed by the switches is usually difficult to calculate, as their operation is time-variant with frequency translation present [6]. Nevertheless, as can be seen from Figure 2.24, either the on-resistance of transistor M1 (M4) or M3 (M2) is connected to one of the outputs at any given time. In effect, the on-resistance R DS given by (2.14) is always connected to the output. Therefore, the LO drive (V LO ) and device width (W) can be increased as much as possible to minimize this resistance and its associated thermal noise for a low NF. Another NF contribution arises from the interval of time in which both complimentary switches M1 and M3 (M2 and M4) are simultaneously on for part of the LO period. During this time the net on-resistance R NET of the two switches in parallel (as seen from the output) remains roughly constant at a value given by [45]: (2.15) which also generates thermal noise at the output degrading the NF. To minimize this, sufficiently large LO signals are needed to make the switches switch almost instantaneously. However large LO signals are becoming more and more difficult to achieve as the voltage is reduced from one technology generation to the next. Finally, the absence of a DC biasing current eliminates transistor flicker (1⁄f) noise which would otherwise be translated to high frequencies upon mixing [27]. This property is also valuable in direct-digital receivers where 1⁄f noise is particularly dominant [46].\n\nPassive mixers nonetheless suffer from a number of drawbacks including conversion loss. Their conversion loss can be readily estimated if we assume that the transistors behave as ideal, instantaneous switches. Then the differential output voltage may be regarded as the result of multiplying the input voltage by a unit amplitude square wave. Since the fundamental component of the square wave has a magnitude of 4⁄π, we may write the following expression for the voltage conversion gain (A v ) [38]:\n\nwhere the desired mixing product is divided evenly between the sum and difference frequency components and hence the factor of 2⁄π is present as opposed to 4⁄π. In practice, the actual voltage conversion gain will drop further from 2⁄π (≈ -4dB) as the transistors do not switch instantaneously and have a non-negligible loss. Also for sinusoidal LO signals, transistors M1 (M4) and M3 (M2) are simultaneously on for a considerable part of the period making the gain even lower. These effects can be mitigated nonetheless by using a large LO drive (V LO ) and FET width (W). However as the width W of the device is made larger, its intrinsic parasitic capacitances increase leading to more capacitive coupling and less isolation between ports, especially at higher frequencies. Such an effect will be discussed in more detail in chapters 3 and 4.\n\nNevertheless, as this circuit exhibits a loss of several decibels, the noise of the following stage is \"amplified\" when referred to the input. This may require a low-noise stage after the mixer to limit the overall NF of the transmitter at the cost of increased power consumption and area [36], [46].\n\nFinally, the overall performance of CMOS passive mixers in terms of conversion gain, linearity and noise figure strongly depends on the available LO drive as discussed above, which emphasizes the need for good LO buffers with adequate driving ability. This is typically achieved using large FETs with a high current consumption to yield a relatively high transconductance g m . Thus to reduce the power consumed by the LO buffers, the gate capacitance of the switches can be resonated with an inductor to generate a higher loading impedance for a larger voltage swing. A potential problem with this however is that the inductors may occupy a very large area especially at low LO frequencies, increasing the cost of the IC considerably. Furthermore, the narrowband resonant behavior of the loading impedance will adversely affect the broadband operation of the LO buffers and the overall mixer [38].\n\nIn this chapter, direct-digital modulators were explored in detail demonstrating their benefits over the traditional heterodyne counterparts. For instance, the IF components and the RF upconverter are no longer needed, simplifying the transmitter and facilitating integration with existing digital CMOS circuits for a reduced size, cost and power consumption. Common digital modulation techniques including PSK were also reviewed as necessary background for this thesis. In particular, quadrature-carrier multiplexing systems such as QPSK were shown to be effective in increasing the bandwidth efficiency by a factor of two compared to BPSK, which is critical in crowded frequency bands. Finally, the most common circuits for the 90° phase shifter and modulating mixers were evaluated to give an overview of the various alternatives available in the design of QPSK modulators. Passive circuits such as RC networks and CMOS passive mixers are generally more suitable for portable wireless applications, as they offer small footprint and zero DC power consumption.\n\nL-Band Direct-Digital QPSK Modulator\n\nThis chapter discusses the new direct-digital QPSK modulator concept developed for this work and describes the design of an L-band modulator in CMOS technology that demonstrates this concept [7]. It also investigates new and commonly used circuit techniques for implementing the baluns and summing junctions required by the modulator. Finally the chapter concludes with simulations and measurement results of the fabricated IC, along with suggestions for further improvements.\n\nThe concept of the proposed QPSK modulator is based on our previous work on direct-digital BPSK modulators using hybrid microwave circuits and MEMS single-pole double-throw (SPDT) switches [47], [48]. A block diagram of the direct-digital QPSK modulator is shown in Figure 3.1. It consists of: 1) a 90° phase shifter, 2) two baluns, 3) two pairs of complementary switches, and 4) a summing junction. A major advantage of this topology is its relative simplicity in terms of size and power consumption compared to most other QPSK modulators. This potentially yields a compact modulator IC with significant savings in size and cost of the transmitter. It is also possible to attain a relatively low DC power consumption with this architecture if passive phase shifters are used, making it attractive for portable communication devices as it prolongs their battery life. Furthermore, since digital modulation is performed directly at the high carrier frequency, more signal bandwidth is potentially available for higher data rates. Therefore as CMOS technology continues to provide faster switching transistors, increasingly high transmission rates are possible for future high-speed wireless applications. As shown in Figure 3.1, the 90° phase shifter first creates two quadrature signals ±cos(ω RF t) and ±sin(ω RF t). One signal from each differential quadrature pair, ±cos(ω RF t) and ±sin(ω RF t), is later selected in the complimentary switch networks according to the in-phase (I) and quadrature-phase (Q) digital data values respectively. Finally, the chosen signals are subtracted in the summing junction at the output. In effect, the circuit implements the following QPSK function:\n\nwhere I(t) and Q(t) represent the in-phase (I) and quadrature-phase (Q) bit streams in time with a value of -1 for logic 0 and +1 for logic 1. It is important to note that the arithmetic operation in (3.1) is merely inconsequential, i.e. either an addition or subtraction can be chosen as long as it is performed using complex vector arithmetic. The reason for choosing the subtraction is that it is very easily accomplished using a differential pair of transistors.\n\nIn this section, the design of the L-band QPSK modulator in CMOS will be described with detailed analysis of its various components including the 90° phase shifter, the baluns, the complimentary switch networks and the summing junction. In addition, important design considerations will be stressed wherever appropriate.\n\nThe resistor-capacitor, capacitor-resistor (RC-CR) network is chosen for generating quadrature carriers due to its simple design, small IC footprint and zero DC power consumption. It is also useful for overcoming phase errors caused by fabrication tolerances as explained later. Figure 3.2 [25] shows the integrating (RC) and differentiating (CR) circuits involved. In this figure, Z 01 and Z 02 are the impedances of the input and output networks, while R and C are the resistance and capacitance of the integrating and differentiating circuits. The in-phase (V I ) and quadrature-phase (V Q ) outputs are given by [25]:\n\n( )\n\nIf the loading impedance Z 02 is made significantly larger than both the resistance R and the source impedance Z 01 i.e. Z 02 >> (R, Z 01 ), then the phase difference θ between the two output signals V I and V Q is given by:\n\nas required. This equation shows that the phase difference is at a constant 90° with no frequency dependence, allowing this phase shifter to operate over a wide bandwidth. Furthermore, it is independent of the resistance R or capacitance C making it insensitive to tolerances of the fabrication process. However it should be noted that any mismatch in resistors or capacitors between the two circuits will introduce phase errors as can be seen from (3.4). In addition, capacitive coupling between the two networks will contribute further to these phase errors. Therefore careful layout is required to minimize these effects [6]. While a 90° phase difference can be readily achieved with this network over a wide bandwidth, it is important to consider the amplitudes of the output signals V I and V Q . The amplitude ratio G is given by:\n\nThe proposed QPSK modulator requires a balun to generate 180° out-of-phase signals from each quadrature carrier as shown in Figure 3.1. The accuracy of this 180° phase split will affect the modulator's performance including its modulation bandwidth.\n\nMany baluns have been reported in the literature to convert an unbalanced, single-ended signal to a pair of balanced, differential signals that are needed for a variety of applications including modulators and mixers. These include: 1) centre-tapped transformers, 2) microwave distributed networks and 3) active circuits using transistors.\n\nEach of these approaches has respective advantages making it more appropriate for the application at hand based on the frequency of operation, available area, cost, and power consumption. Centre-tapped transformers illustrated in Figure 3.4 operate on the principle of magnetic induction and are commonly used at lower RF frequencies up to a few GHz [49]- [52]. The centre of the secondary coil is tapped and grounded so that the input voltage V 1 is split evenly between the output voltages V 2 and V 3 with a 180º phase difference between them. Although these passive transformers consume zero DC power, they can be physically large and generally have high losses. Nevertheless they can be made smaller by using ferrite iron cores, which raises the cost and requires packaging. Microwave distributed networks such as the classic [35] and tapered coupled line 180° ring hybrids [35] using planar transmission lines (e.g. microstrip or coplanar waveguides) can provide a very precise 180° phase shift over a wide frequency range [35]. A typical 180° ring hybrid is shown in Figure 3.5, which consists of four ports matched to the system impedance Z 0 around a ring of characteristic impedance (√2)Z 0 .\n\nThe input is applied to port 4 so that the signal is split equally into two components with a 180° phase difference between them at ports 2 and 3, while port 1 is isolated. As the input power is divided evenly (i.e. by a factor of ½) between the two output signals, the voltage conversion loss of this network is at least 1/√2 or 3dB. Although a thorough quantitative analysis may be carried out to find the S-parameters and verify the network's operation, the procedure can be easily found in any text such as [35]. Here an intuitive explanation will suffice. As the input signal enters port 4, it travels a distance of 3λ/4 to reach port 2 whereas it travels only λ/4 to reach port 3. Therefore the phase difference between the two signals appearing at ports 2 and 3 is λ/2 or 180° as required. For port 1, the signal at port 4 is divided into two components that traverse two different paths around the ring, one of length λ/2 and the other of length λ. The phase difference between these two components is again λ/2 or 180°, canceling each other out when they combine at port 1 and therefore isolating it. An advantage of 180° ring hybrids and microwave distributed networks in general is that they are well established theoretically and can be readily designed with excellent model-to-hardware correlation. However, these hybrids are large for monolithic IC integration especially at lower RF and microwave frequencies where the wavelength λ is in the order of centimeters. For this reason, they are not often used in IC designs. Active baluns employ field-effect transistors (FETs) in a certain configuration to create 180° out-of-phase signals from a single-ended input. A major advantage of active baluns is one of conversion gain, reduced area and ease of IC integration. Compared to transformer and transmission line baluns, they can be very compact especially at low RF frequencies where passive structures can be quite large. However, the FETs will inherently add thermal and 1/f noise to the output signals. They will draw DC current as well contributing to the power consumption of the modulator and the overall transmitter.\n\nNonetheless they allow the modulator to be integrated on-chip serving towards a fully integrated direct-digital transmitter that is very compact and inexpensive. The simplest single-transistor balun is shown in Figure 3.6 [53]. It consists of a FET with load resistors connected to the source and drain and the input applied to the gate. The input signal V in is transferred in-phase to the source but 180° out-of-phase to the drain. At low frequencies, the hybrid-π model shown in Figure 3.7 is adequate to perform a small signal analysis and derive the following tractable expressions for the output voltages V out1 and\n\nwhere g m is the transconductance of the FET, R s is the resistance at the source and R d is the resistance at the drain. These equations show that the output signals will indeed be 180° out of phase independent of component values, but for them to have equal amplitudes, i.e. |V out1 | = |V out2 |, the following condition must to be satisfied:\n\nIn addition, to reduce the conversion loss as much as possible towards unity-gain, i.e.\n\n|V out1 /V in | = |V out2 /V in | ≈ 1, the transconductance g m of the FET should be increased so that R s >> 1/g m or g m >> 1/R s . This is typically achieved using a larger FET width W with high current consumption, I DS . However for higher frequencies a more careful analysis is needed that includes the parasitic capacitances of a physical MOSFET illustrated in Figure 3.8 [54]. A high-frequency hybrid-π model can then be derived based on this as shown in Figure 3.9. It is clear that as the frequency increases, the impedance of the gate-drain capacitance C gd decreases, allowing part of the input signal to pass directly to the drain. This causes the phase reversal of V out2 to deviate appreciably from 180°. Such a discrepancy will degrade the performance of the balun and the proposed modulator.\n\nMoreover, there are other parasitics in the FET that can contribute further to this phase imbalance. In conclusion, the balun in Figure 3.6 is an attractive solution at low to moderate RF frequencies below 1GHz or so, depending on the device technology.    More common active baluns that have better performance than single-transistor circuits take on the form of a common-gate, common-source (CG-CS) pair or a differential pair with one input AC grounded [55], [56]. In the CG-CS configuration, the common-gate transistor amplifies the input signal in-phase while the common-source one amplifies it with a phase reversal. By matching the gain of these amplifiers, the two outputs can have equal amplitudes. A schematic of a CG-CS pair designed in previous work [57] and used in this QPSK modulator is shown in Figure 3.10 below.\n\ngiven by 1/g m . Therefore the common-gate device can be designed with the appropriate size and bias current to yield a low input resistance close to the 50Ω system impedance.\n\nThe biasing source resistance R bias is also chosen large enough not to greatly affect the input impedance or attenuate the signal. As the low impedance of this common-gate circuit is in parallel with the very high impedance of the common-source device, it dominates the overall input impedance of the balun. Thus it provides a low reflection coefficient so that most of the signal power is absorbed and not reflected [57]. In contrast, the input impedance looking into a single-transistor or differential-pair balun is very high making the reflection coefficient rather poor. A matching network must therefore be implemented in this case using passive structures such as inductors, capacitors or transmission lines, occupying a large area on the IC and defeating the main advantage of active baluns. Furthermore, the input match provided by the common-gate circuit is typically broadband as opposed to narrowband in passive networks, albeit the reflection coefficient could be higher at the centre frequency [35], [57].  over the same frequency band. These results indicate that this balun is relatively wideband for this technology. The magnitude of the input reflection coefficient S 11 is   Chapter 3 L-Band Direct-Digital QPSK Modulator 50 -1 -0.8 -0.6 -0.4 -0.2 0 0.2 0.4 0.6 0.8 1 1 2 3 4 5 6 7 8 9 10 Frequency (GHz) Amplitude Balance (dB) Figure 3.13: Simulated CG-CS balun amplitude balance from 1GHz to 10GHz.\n\n-15 -14 -13 -12 -11 -10 -9 -8 -7 -6 -5\n\nThe purpose of the I, Q complimentary switch networks is to pass one signal from each quadrature balanced pair (±cos(ωt) and ±sin(ωt)), while blocking the other one. In particular, the in-phase signal cos(ωt) or sin(ωt) is passed for a binary digit of I = 1 or Q = 1, while the out-of-phase signal -cos(ωt) or -sin(ωt) is passed for I = 0 or Q = 0 thus creating the I(t)cos(ωt) or Q(t)sin(ωt) product term in (3.1). The two selected quadrature carriers can then be subtracted to generate the QPSK vector signal as shown in the next section.\n\nEach complimentary switch network is essentially a Pass-Transistor Logic (PTL) circuit consisting of a pair of NMOS switches as shown in Figure 3.15, which have the advantages of small footprint, zero DC power consumption and high-speed operation.\n\nAn NMOS FET can be naturally used as a switch, with the path of interest being between the source and drain of the device and the state controlled by the voltage applied to the gate (Figure 3.16). If the gate-to-source voltage (V GS ) is less than the threshold voltage V T , no channel is created between the drain and source, and the device is said to be operating in the cut-off region. The switch is therefore in the OFF state, and can be simply modeled as an open circuit. On the other hand, if the gate voltage is well above the threshold V T , e.g. at the supply voltage V dd , a uniform channel is created between the drain and source, and the device is operating in the triode or linear region. The switch in this case is ON as the signal readily passes through the small channel resistance. The drain-to-source current-voltage (I DS -V DS ) characteristic of the NMOS FET in this state (triode region) can be written as [1]:\n\nwhere µ n is the electron mobility, C ox is the gate oxide capacitance per unit area, W and L are the width and length of the NMOS transistor, E sat is the velocity saturation electric field, V GS is the gate-to-source voltage, and V T is the threshold voltage. Since the drainto-source voltage (V DS ) is significantly smaller than the gate overdrive voltage (V GS -V T ) and the velocity saturation voltage (LE sat ), this equation can be approximated as:\n\nFrom equation (3.10) above the NMOS switch can be simply modeled as a resistance R DS in the ON state (Figure 3.16) given by: (3.11) where the applied gate-to-source voltage V GS is equal to the supply voltage V DD in this case:\n\nIt is clear from (3.12) that increasing the device width W as much as possible would minimize the switch's on-resistance R DS and thus reduce the signal loss across it.\n\nHowever at high frequencies a more careful analysis is necessary that includes the most important intrinsic parasitic capacitances of the FET (Figure 3.8) in the switch model as shown in Figure 3.17 [58]. The gate-to-source (C gs ) and gate-to-drain (C gd ) capacitances in the model are given by [54]:\n\nwhere C gc is the gate-to-channel capacitance, C ov is the overlap capacitance of the gate oxide with the drain or source diffusion, L eff is the effective channel length and L D is the diffusion overlap length. The factor of ½ is present as the channel is uniform in the triode region as opposed to pinched off at the drain in the saturation region (Figure 3.8); so the total gate-to-channel capacitance C gc = C ox WL eff can be split evenly between the source and drain. While the overlap capacitance C ov = C ox WL D has been traditionally neglected due to its small value compared to the gate-to-channel capacitance C gc , it is becoming more significant as the device length L scales down from one technology generation to the next. Regardless, it is still clear from (3.13) that as the width W of the device is made larger, the gate-to-source (C gs ) and gate-to-drain (C gd ) capacitances increase, reducing their impedance and allowing more of the RF signal to be shorted to AC ground. This leads to a higher signal loss adversely affecting the performance of the QPSK modulator. Therefore a trade-off between these two effects is necessary and a medium device size of ten 2.5µm-wide fingers is used.\n\nA summing junction is required by the QPSK modulator to combine (subtract) the two quadrature signals selected by the input data. This should be performed with sufficient accuracy so as not to degrade the performance of the QPSK modulator significantly. Many passive summing junctions have been reported in the literature to add or subtract signals for various RF/Microwave circuits including mixers. Among them are transmission-line networks, such as the ring hybrid, T-junction and the Wilkinson power combiner. The 180° ring hybrid shown in Figure 3.5 for example can be operated as a combiner with the input signals applied to ports 2 and 3, so that the sum of the signals is formed at port 1, while the difference is formed at port 4. The T-junction shown in Figure 3.18 is a simpler three-port network that is also implemented using planar transmission lines, but it suffers from poor input match and very low isolation between the two input ports, allowing the signals to interfere with each other. The Wilkinson power combiner (Figure 3.19) offers good isolation between the two inputs as well as an impedance match for all three ports at the design center frequency. Other networks such as transformers and lumped-element circuits (resistor and/or capacitors) have also been used. The centre-tapped transformer in Figure 3.4 for example can be operated as a combiner with the two inputs applied to V 2 and V 3 , so that their difference is generated at V 1 . Resistors or capacitors connected in a T-network configuration (Figure 3.20) provide a simple solution as well. However the insertion loss of these combiners can be excessively high.   An active difference circuit using FETs is employed in this work as opposed to a passive combiner, since the latter can be quite large at this frequency band to integrate on-chip. It can also provide insertion gain albeit at the cost of DC power consumption, noise and large-signal distortion. Figure 3.21 below shows the circuit schematic of the summing junction with the DC bias networks omitted for clarity. It consists of a differential pair amplifier and an output buffer using only five transistors and resistors making its size comparatively small for IC integration. The differential pair amplifier subtracts the quadrature outputs of the complimentary switch networks (I(t)cos(ωt) and Q(t)sin(ωt)) and generates the resultant QPSK signal vector (QPSK(t)) as in (3.1). Figure 3.22 below illustrates this vector subtraction process. The intrinsic parasitics of the FETs, particularly the gate-to-source capacitance C gs , provides a capacitive path between the quadrature inputs V I and V Q of the differential pair as shown in Figure 3.23. This essentially pulls the quadrature phases closer together creating a phase and amplitude imbalance at the inputs, which in turn translates to discrepancies upon subtraction at the output. Such capacitive coupling can cause significant phase and amplitude errors if the output impedance of the preceding stage is not sufficiently small. Therefore buffering the baluns using source followers (Figure 3.3) lowers their output impedance and minimizes this effect. In addition, choosing a small width W for the FETs helps to reduce capacitive parasitics and coupling between the inputs. However, a smaller FET exhibits a lower transconductance, reducing the conversion gain of the differential pair.  The differential amplifier also eliminates traces of spurious signals and noise that are in common-mode. However, the outputs of the differential pair (V + , V -) should be taken differentially (i.e. V + -V -) and not single-ended for this to happen. Doing so also provides a larger signal swing for a higher transmission gain. Therefore an output buffer of common-drain and common-source devices converts the differential outputs to a single-ended one and drives the external 50Ω load. The common-drain device transfers the positive voltage (V + ) while the common-source device inverts the negative one (V -) so that the two signals combine in-phase at the load. The output impedance looking into the source of the common-drain FET is approximately given by 1/g m . Thus the commondrain device can also be designed with the appropriate size and bias current to yield a low output resistance close to 50Ω. As the low impedance of the common-drain FET (M3) is in parallel with the relatively large impedance of the common-source device (M4), it dominates the overall output impedance of this buffer stage. This presents a low reflection coefficient over a wide bandwidth as opposed to using a conventional matching network.\n\nIn this section, the simulation and testing procedure of the L-band QPSK modulator circuit in 0.18µm CMOS technology will be discussed in detail. The acquired results from these simulations and measurements will be presented along with important practical considerations.\n\nThe QPSK modulator design was simulated in Agilent Advanced Design System (ADS) software using Taiwan Semiconductor Manufacturing Company (TSMC) 0.18µm RF CMOS BSIM3 device models for the transistors. The full circuit schematic of the QPSK modulator is shown in Figure 3.24. To verify the circuit's operation, a timedomain simulation was run with a 1.7GHz, -20dBm sinusoidal signal source for the carrier, and 100Mbps pseudo-random binary sequences (PRBS) to mimic random digital data at the I and Q inputs. These sequences were encoded in the non-return-to-zero (NRZ) format with rectangular pulses having a low level of 0V (ground) for logic 0 and a high level of 1.8V (V dd ) for logic 1. It is important to note that a high data rate of 100Mbps was necessary for this simulation because of the speed and memory constraints of the computer system. The difficulty arises from the widely different frequencies involved: tracing the fast-varying carrier signal long enough to obtain adequate information about the relatively slow modulating signal can be computationally expensive. For instance, with the carrier frequency at 1.7GHz, the maximum simulation time step can only be around 0.05ns if 10 data points are required per cycle. To cover 200 symbols (dibits) of data at a much lower modulation rate, say 1Mbps, a total simulation time of 200µs or 4×10 6 points is required. Such a large amount of processing can exhaust the computer's resources or take a very long time, becoming more of a problem if the carrier frequency is increased. However at 100Mbps, the number of data points needed is only 40000, which significantly reduces computational time and memory requirements.   To view the signal constellation of the QPSK modulator's output, an envelope simulation was set up in ADS using the same signal sources for the carrier and digital data. The simulation was run for 8 symbol periods at 100Mbps, or 80ns in total. The resulting constellation of the modulator's output voltage is shown in Figure 3.27, with the generated points very close to the ideal QPSK constellation discussed in Chapter 2 (Figure 2.11), further verifying the design of our QPSK modulator. From the phase values marked on each point in the plot, the maximum phase error is approximately 5°\n\nbetween adjacent (quadrature) points and about 1.8° between opposite (complimentary) points. Similarly, the maximum amplitude imbalance between all four points is about 1.04 or 0.3dB. As the lowest voltage amplitude is about 14.8mV, the power available at the 50Ω load is -26.6dBm, which implies that the signal exhibits a loss of 6.6dB from a -20dBm input. Nevertheless the phase and amplitude imbalance are comparatively small, ensuring adequate modulation accuracy and bandwidth.\n\nThe QPSK modulator was fabricated in a standard (six-metal, single-poly) 0.18µm CMOS process. A photograph of the IC is shown in Figure 3.28. It occupies a die area of about 0.425 × 0.675mm without bonding pads and 0.425 × 0.825mm with bonding pads included. The circuit consumes less than 24mA of current from a 1.8V voltage supply, i.e. 43mW of power. To test the QPSK modulator IC, a direct on-wafer measurement was carried out using Cascade Microtech coplanar waveguide (CPW) probes and DC probes on a Wentworth probe station. An Anritsu signal generator (model MG3694A) and Tektronix arbitrary function generator (model AFG310) were used to apply the input carrier signal and digital data signals respectively. To examine the output signal spectrum, the Agilent E4446A spectrum analyzer was used. Finally, a vector network analyzer (Agilent 8510C) was employed for all S-parameter measurements including QPSK signal constellations and reflection coefficients. Prior to the VNA measurements, a full twoport SOLT calibration was performed using a SUSS MicroTec calibration substrate. The first measurement performed was the loss through the modulator while the I and Q data switches are held at constant values to generate the base QPSK constellation signal, corresponding to the symbol (dibit) value of I = 1 and Q = 1. A high voltage level\n\n(1.8V) representing logic 1 is applied to both I and Q data channels, connecting the 0° and 90° paths to the summing junction for combination at the output, as depicted in Figure 3.1. The magnitude of the transmission coefficient from the input to the output (S 21 ) in this state is shown in Figure 3.29 from 1.5GHz to 1.9GHz. It is clear that the loss exhibited at the centre frequency of 1.7GHz is about 8.2dB, which is relatively close to simulation and not overly excessive, at least when compared to other QPSK modulators.\n\nIf we consider the equal four-way power split of a signal by a passive solution for example, the minimum theoretical loss is already 6dB, and in addition there are parasitic losses through the silicon substrate, metal conductors and switches that could increase the total loss beyond the 6-8dB range. The input reflection coefficient (S 11 ) was also measured in this state and a similar plot of its magnitude is shown in Figure 3.30. At the centre frequency of 1.7GHz, the reflection coefficient is quite high at about -4.5dB. This is due to the relatively high input impedance presented by the RC-CR network. While a high reflection coefficient is generally not desirable, it should be noted that in the context of a typical direct-digital transmitter, the on-chip local oscillator (LO) will be preceding this QPSK modulator instead of a 50Ω signal generator. So a relatively high loading impedance from the perspective of the LO could be advantageous for increased voltage swing. Nevertheless, this reflection coefficient will be significantly improved upon in the enhanced S-band modulator by ensuring an adequate impedance match to 50Ω, as discussed in more detail in Chapter 4.  To assess the 90° phase difference and amplitude match of two quadrature signals in the QPSK constellation, the switches were held fixed at the same base state with the transmission coefficient S 21 measured, then the switches were toggled for the adjacent constellation point of I = 1, Q = 0, and S 21 was again measured. For the first state, a high voltage level of 1.8V was applied for both I and Q data inputs as before, but in the second state, the voltage for the Q input is switched to 0V for logic 0. The difference in the phase of the measured transmission coefficient S 21 in each state is plotted in Figure 3.31 over a span of 400MHz around the centre frequency. As depicted from the plot, the phase difference reaches about 84.7° for a relatively low phase error of 5.3°, in close agreement with our simulation results presented earlier. The magnitude ratio between these transmission coefficients is also plotted on a similar graph in Figure 3.32, indicating a low amplitude imbalance of 0.4dB at around the same frequency.  While the quadrature phase match is probably the most important feature of the QPSK constellation, it is still necessary to examine the 180° phase difference between opposite points in the constellation. In this test, the switches were again held fixed at the same base state while the transmission coefficient S 21 was measured, then the switches were toggled for the opposite constellation point of I = 0, Q = 0 and S 21 was again measured. For the first state, a high voltage level of 1.8V was applied for both I and Q data inputs as before, but in the second state their voltage is switched to 0V for logic 0.\n\nThe difference in the phase of the measured transmission coefficient S 21 in each of these states is plotted in Figure 3.33 over a span of 400MHz around the centre frequency. As depicted from this plot, the best phase difference reaches about 179° for a very low phase error of 1°. The magnitude ratio between these transmission coefficients is also plotted similarly in Figure 3.34, indicating an amplitude imbalance of 1.7dB at around the same frequency. This is equivalent to an absolute ratio of 1.2 which is actually quite significant. Such discrepancies are largely the result of component tolerances, device mismatches and asymmetries in the circuit, which are usually accounted for in a second design cycle. However in our modified S-band modulator, a tunable solution is adopted to trim these errors as much as possible, as described in Chapter 4.  To measure the QPSK modulator's carrier rejection, the same square wave is applied to both I and Q data channels, with an amplitude level of 1.8V (V dd ) in the high state and 0V (ground) in the low state. At 1.8V the NMOS switches are fully turned on, while at 0V they are practically off. The output of the IC is then connected directly to the spectrum analyzer. The frequency of the square wave f MOD is chosen to be 0.5MHz (time period T = 1/f MOD = 2µs) for a 1Mbps data rate per channel or a total data throughput of 1Mbps × 2 channels = 2Mbps. From Fourier signal analysis, the frequency spectrum of an ideal periodic square wave has non-zero components only at the odd-order harmonics of the fundamental frequency (0.5MHz, 1.5MHz, 2.5MHz and so on), featuring a sincshaped amplitude envelope. This spectrum is shifted in frequency by the carrier upon modulation. Figure 3.35 shows the resulting output signal spectrum with a centre (carrier) frequency of 1.76GHz, a frequency span of 25 MHz and resolution bandwidth of 240kHz. The spectrum shape is quite good with a high degree of symmetry around the centre frequency. As depicted from the plot, the carrier at 1.76GHz is also well suppressed by more than 40dB relative to the main lobes at 1.76GHz ± 0.5MHz. However, although relatively small, a few imperfections are apparent in the output spectrum shown in Figure 3.35, including non-zero even-order components. This is most likely due to the limited bandwidth of DC probes and its associated dispersive effects on the digital signals. Other non-idealities include the finite rise and fall times of the generated square wave, along with the finite switching time of the NMOS switches, which allow both paths in a complimentary pair to be simultaneously on. Such intervals can be significant compared to the symbol period involved (1µs), possibly contributing to the discrepancies observed in the output spectrum.\n\nAs the transmitted information in real-world communication systems is most often random as opposed to periodic, further tests were carried out. Pseudo-Random Binary Sequences (PRBS) with a 9-bit shift register were employed to mimic random digital data for the input I and Q channels. The sequences were encoded in the nonreturn-to-zero (NRZ) format with rectangular pulses having an amplitude level of 0V (ground) in the low state and 1.8V (V dd ) in the high state. Their data rate was set to be 10Mbps (pulse width T = 1/f MOD = 0.1µs) for a total data throughput of 10Mbps × 2 channels = 20Mbps. Finally, the output of the IC was directly connected to the spectrum analyzer. Figure 3.36 shows the resulting output signal spectrum with a centre frequency of 1.76GHz and a frequency span of 100MHz. The resolution bandwidth and averaging of the spectrum analyzer were set to 910kHz and 100 points respectively. It is evident that the circuit operates as a QPSK modulator with its generated spectrum closely matching the theoretical QPSK power spectrum discussed in Chapter 2 (Figure 2.13). The output spectrum is also quite smooth with little or no imperfections in its sinc-squared shape. The QPSK modulator was also tested at higher speeds. For a data rate of 16Mbps per channel or 32Mbps total, which is the highest frequency setting on the arbitrary function generator, the measured output spectrum of the modulator is as shown in Figure 3.37. While the main (center) lobe of the spectrum remains mostly intact, there are visible discrepancies in the side lobes due to practical non-idealities. The low bandwidth of DC probes has definitely limited the maximum data rate that can be tested for this QPSK modulator. To alleviate this problem and enable higher data rates, highperformance CPW probes are used to apply the digital data signals on the IC for the enhanced S-band modulator, as discussed in Chapter 4. Table 3.1 below summarizes the measured characteristics of the L-band QPSK modulator. Table 3.1: Summary of measured characteristics of L-band QPSK modulator. Characteristic Results Active Area 0.425 × 0.675mm DC Power Consumption 43mW from 1.8V Insertion Loss 8dB Carrier Rejection > 40dB Data Throughput Nominal: 20Mbps\n\nThe proposed concept for the new QPSK modulator builds on our previous work described in Chapter 3. A block diagram illustrating it is shown in Figure 4.1. It consists of: 1) a 180° balun, 2) a 90° phase shifter and 3) a switch network. The main advantage of this topology is its relative simplicity compared to our previous QPSK modulator, as it requires only one balun and no summing junction. This potentially yields a more compact modulator IC with additional savings in size and cost of the transmitter. In addition, a lower DC power consumption can be attained if a passive 90° phase shifter is used, making it more attractive for portable communication devices that are batterypowered. Furthermore, since the need for a summing junction is completely eliminated, its associated non-idealities are no longer present, enabling higher modulation accuracy and data rates for more ambitious wireless applications.\n\n180° Balun 90° Phase Shifter 0°1 80°9 0°-90°0 °180°C arrier Input I Digital Data Q Digital Data QPSK Output As shown in Figure 4.1, the 180° balun first splits the input RF carrier into a pair of differential, balanced signals. These signals are then fed to the 90° phase shifter which generates differential quadrature signals, yielding all four quadrature phases of the carrier: 0°, -90°, 90° and 180°. Only one from the four differential quadrature signals is later selected in the switch network according to both in-phase (I) and quadrature-phase\n\nIn this section, the design of the S-band QPSK modulator in 0.18µm CMOS will be described with detailed analysis of its various components including the balun, the 90° phase shifter and the switch network. In addition, important design considerations will be stressed wherever appropriate.\n\nThe proposed QPSK modulator requires a balun to generate 180° out-of-phase signals from the input carrier as shown in Figure 4.1. The accuracy of this 180° phase split will affect the modulator's performance including its modulation bandwidth. The same active balun discussed in Chapter 3 [57] which consists of common-gate and common-source FETs (CG-CS) is also used here for the advantages of conversion gain, reduced area and ease of IC integration. Its performance was optimized over the S-band frequency range from 2GHz to 4GHz as appropriate for this modulator design. The circuit schematic of the CG-CS pair is repeated below in Figure 4.3 for convenience. The common-gate device of the CG-CS active balun is designed with the appropriate width and bias current to yield a low input resistance (≈1/g m ) close to the 50Ω system impedance. This is achieved over a wide bandwidth without using any bulky matching networks as described in Chapter 3. The biasing source resistance R bias is also chosen large enough not to greatly affect the input impedance or attenuate the signal.\n\nFinally, the gains of the common-source and common-gate amplifiers (≈g m R d ) are matched for the two outputs to have equal amplitudes.\n\nThe outputs V 0 and V 180 of the balun (Figure 4.3) are buffered using FETs in a common-drain (source follower) configuration similar to those described in Chapter 3 (Figure 3.3). This is needed to isolate the outputs from the following 90 º phase shifter, presenting a larger loading impedance for improved performance including conversion gain. The buffers are also necessary to sufficiently drive the relatively low input impedance of the 90º phase shifter, which is discussed in more detail in the next section.  To verify the circuit's operation, an S-parameter simulation was run over the Sband frequency range from 2GHz to 4GHz with 50Ω ports at the input and outputs as shown in Figure 4.4. The magnitude of the resulting input reflection coefficient S 11 is plotted in Figure 4.5. It is clear that the coefficient's magnitude is quite low and less than -11dB over the entire bandwidth. This means that most of the carrier signal power is absorbed by the circuit and not reflected at the input as desired. The transmission coefficient S 21 from the input to the in-phase output was also computed and its magnitude plotted in Figure 4.6. It is apparent that the transmission coefficient is quite flat with less than ±0.25dB variation across the frequency band and a maximum value of -0.9dB. A signal loss of 0.9dB is actually quite good, at least when compared to a passive balun since an equal two-way power split has a minimum theoretical loss of 3dB. Furthermore, the reflection coefficient S 22 looking into the circuit from this output is shown in Figure 4.7. Its magnitude is less than -8dB and can be as low as -16dB in this frequency band, indicating that the output resistance of the circuit is sufficiently low (≈50Ω) for the following 90° phase shifter. Chapter 4 S-Band Direct-Digital QPSK Modulator 80 -\n\n.0 2.2 2.4 2.6 2.8 3.0 3.2 3.4 3.6 3.8 4.0 Frequency (GHz) |S21| (dB) -\n\n.0 2.2 2.4 2.6 2.8 3.0 3.2 3.4 3.6 3.8 4.0 Frequency (GHz) |S22| (dB) As the transmission coefficient S 31 from the input to the antiphase output is also computed in this S-parameter simulation, the phase and amplitude difference between the two balun outputs can be examined. The difference in the phase of the transmission coefficients S 21 and S 31 is plotted in Figure 4.8 from 2GHz to 4GHz. As depicted from the plot, the phase difference is quite flat and reaches a maximum of about 180.7° for a very low discrepancy of 0.7° from the desired 180°. The magnitude ratio between these transmission coefficients is also plotted on a similar graph in Figure 4.9, indicating a particularly low amplitude imbalance of 0.075dB over the same frequency band. This verifies and completes the design of the active CG-CS balun for the proposed QPSK modulator.\n\n175 176 177 178 179 180 181 182 183 184 185 2.00 2.20 2.40 2.60 2.80 3.00 3.20 3.40 3.60 3.80 4.00 Frequency (GHz) Phase Difference (Degrees) -0.5 -0.4 -0.3 -0.2 -0.1 0 0.1 0.2 0.3 0.4 0.5 2.0 2.2 2.4 2.6 2.8 3.0 3.2 3.4 3.6 3.8 4.0 Frequency (GHz) Amplitude Imbalance (dB) Figure 4.9: Amplitude imbalance between balun outputs.\n\nThe resistor-capacitor (RC) polyphase network is chosen for generating quadrature carriers due to its simple design, small IC footprint and zero DC power consumption. It also offers a lower signal loss compared to using two RC-CR circuits, one for each differential signal. This is because it combines the two balanced signals in a quadrature fashion as opposed to splitting each signal separately.  As previously discussed in Chapter 2, the RC polyphase network generally has an all-pass frequency response with the amplitudes matched irrespective of frequency, while the desired 90° phase difference only appears at the cut-off frequency of 1/(RC).\n\nTherefore at the relatively high carrier frequencies involved, a small RC product is required. This is beneficial as it allows small resistors and capacitors to be used.\n\nHowever integrated polysilicon resistors generally exhibit large tolerances (more than 20%) for small footprints and low resistance values (less than 1kΩ). Such high tolerances are critical since descrepancies will change the network's cutoff frequency, introducing phase errors at the frequency of interest. For this reason, an alternative resistor implementation is preferred in the form of an NMOS transistor biased in the triode region, with the path of interest being between the drain and source of the device and its resistance controlled by a tuning voltage (V TUNE ) applied to the gate (  A definite advantage of using voltage-controlled resistors is that the RC polyphase network can now be fine-tuned for the lowest possible phase error after process variations. As described in Chapter 3, an NMOS transistor operating in the triode region has a channel induced between its drain and source, with a drain current-voltage (I DS -V DS ) characteristic given by: ( )\n\nSince the drain-to-source voltage (V DS ) is significantly smaller than the gate overdrive voltage (V GS -V T ) and the velocity saturation voltage (LE sat ), this equation can be approximated as:\n\nyielding an equivalent resistance R DS :\n\n) (\n\nwhere V GS is the applied gate-to-source voltage which is equal to the tuning voltage V TUNE in this case:\n\nIt is now clear that the device behaves as a variable resistor with its resistance (R DS )\n\ninversely proportional to the applied tuning voltage (V TUNE ) and gate width (W).\n\nTherefore a large voltage and/or gate width can be chosen to yield a relatively low resistance value. However at RF frequencies, it is necessary to consider the intrinsic parasitics of the FET (Figure 3.8).  The differential quadrature outputs V -90 , V 0 , V 90 and V 180 of the polyphase filter  The 90° phase shifter design was simulated in Cadence software using Taiwan Semiconductor Manufacturing Company (TSMC) 0.18µm RF CMOS BSIM3 device models for the transistors. The full circuit schematic of the phase shifter is shown in Figure 4.14. To verify the circuit's operation, an S-parameter simulation was set up with 50Ω ports at the input and outputs as shown in the figure. An ideal balun was also used to generate the needed balanced signals at the inputs of the polyphase network, as opposed to the active balun designed in the previous section. This allows us to examine the phase and amplitude accuracy of the 90° phase shifter separately to validate its design procedure. The cutoff frequency of the polyphase network (1/RC) was chosen to be 2.4GHz The real part of this result Re{Z in } is plotted against frequency in Figure 4.16, showing a constant value of about 700Ω. However the impedance Z in looking in from port 1 also includes the 50Ω impedance of port 2 in series. Therefore if 50Ω is subtracted from this\n\nThe above design values for C, W and V TUNE were entered in the schematic and the S-parameter simulation was run over the S-band frequency range from 2GHz to 4GHz. The phase of the resulting transmission coefficients of the polyphase network (S 21 , S 31 , S 41, and S 51 ) from the input to the outputs is plotted in Figure 4.17 from 2GHz to 4GHz. As indicated on the plot at 2.4GHz, the phase differences between the outputs are very close to the desired 90°, 180° and 270° (-90°), with a maximum phase error of only 0.08°. The magnitudes of these transmission coefficients are also plotted on a similar graph in Figure 4.18, indicating a particularly low amplitude imbalance of 0.071dB at the same frequency. This verifies the design procedure of the 90° phase shifter for the proposed QPSK modulator.\n\n0 50 100 150 200 250 300 350 400 2.0 2.2 2.4 2.6 2.8 3.0 3.2 3.4 3.6 3.8 4.0 Frequency (GHz) Phase (Degrees) V-90°V 0°V 90°V 180°8 9.92°1 80.0°2 69.92° -8 -7 -6 -5 2.0 2.2 2.4 2.6 2.8 3.0 3.2 3.4 3.6 3.8 4.0 Frequency (GHz) Magnitude (dB) V-90 V0 V90 V180 0.071dB The magnitude plot in Figure 4.18 seems to indicate that the signal loss through the 90° phase shifter is around 6.6dB. However this loss is only valid when the outputs are loaded with 50Ω ports. In the context of the overall QPSK modulator, this circuit will actually be followed by a switch network and then by an output buffer, which provides a much higher loading impedance and enables the common-source FETs to amplify the signals. Therefore the overall signal loss will be lower than Figure 4.16 suggests, as discussed in section 4.3.4.\n\nThe purpose of the switch network is to pass one signal from the four differential quadrature signals (V -90 , V 0 , V 90 and V 180 ) while blocking the other three, according to both I and Q data values which constitute the QPSK symbol. In particular, the following digital logic should be realized by the switch network in order to yield the desired QPSK signal constellation (Figure 4.2) at the output:\n\nwhich can be simplified to:\n\n) An NMOS FET can be naturally used as a switch, with the characteristic models in increasing the FET width W will reduce its on-resistance R DS given by (3.12) and thus the signal loss across it, it will also increase its gate-to-source (C gs ) and gate-to-drain (C gd ) parasitic capacitances as in (3.13). This leads to more capacitive coupling between the I and Q digital data signals and the QPSK signal, adversely affecting the performance of the QPSK modulator. Therefore a narrow gate width of W = 1.5µm was chosen for this design to minimize this effect, especially at higher data rates where it is more pronounced. To maintain circuit symmetry between the I and Q data inputs and present the same loading impedance (i.e. gate parasitic capacitance) to both, transistors M5 and M6 are made twice as wide as transistors M1-M4 with W = 3µm.\n\nThe QPSK signal output V QPSK of the switch network (Figure 4.19) is buffered using a FET in a common-drain (source follower) configuration similar to the one described in Chapter 3 (Figure 3.3). This is needed to present a large loading impedance for the switch network and the preceding common-source amplifiers to reduce the insertion loss. The buffer is also designed to drive the external 50Ω load with a low reflection coefficient by ensuring an adequate output impedance match in the buffer given by:\n\nwhere g m is the transconductance of the FET and R s is the source resistance. This can be achieved over a wide bandwidth as opposed to using a narrowband passive network which could also be prohibitively large in this frequency range (2.4GHz). 4.3.4 QPSK Modulator Simulation The complete QPSK modulator design was simulated in Cadence software using Taiwan Semiconductor Manufacturing Company (TSMC) 0.18µm RF CMOS BSIM3 device models for the transistors. The full circuit schematic of the QPSK modulator is shown in Figure 4.20.\n\nTo assess the signal constellation of the QPSK modulator, an S-parameter simulation was set up in Cadence with 50Ω ports at the carrier input and the QPSK output, in addition to DC voltage sources for the I and Q data inputs. The simulation was then run over the S-band frequency range from 2GHz to 4GHz. The voltage values for the DC sources were also swept from 0V to 1.8V in a parametric analysis to include all four possible combinations of the I and Q data values (00, 01, 11, 10), with 0V denoting logic 0 and 1.8V denoting logic 1. This in effect simulates all four points in the desired signal constellation (Figure 4.2) one at a time. The phase of the resulting transmission coefficient (S 21 ) from the input to the output in each of these four cases is plotted in Figure 4.21. As indicated on the plot at 2.4GHz, the phase differences between the outputs are very close to the desired 90°, 180° and 270° (-90°), with a maximum phase error of only 0.26°. The magnitude of this transmission coefficient is plotted on a similar graph in Figure 4.22, indicating a particularly low amplitude imbalance of 0.079dB at the same frequency. Also it is clear that the signal exhibits a maximum loss of about 3.3dB, which is not excessive if we consider the fact that the minimum theoretical loss through an equal 4-way power split is 6dB as discussed in Chapter 3. In conclusion, the low phase and amplitude errors show that the generated signal constellation is close to the ideal QPSK one (Figure 4.2), thus verifying the design of our modulator. -100 -50 0 50 100 150 200 250 300 350 2.0 2.2 2.4 2.6 2.8 3.0 3.2 3.4 3.6 3.8 4.0 Frequency (GHz) Phase of S21 (Degrees) I=0, Q=0 I=0, Q=1 I=1, Q=0 I=1, Q=1 90.14°1 79.84°2 69.74° -8 -7 -6 -5 -4 -3 -2 -1 2.0 2.2 2.4 2.6 2.8 3.0 3.2 3.4 3.6 3.8 4.0 Frequency (GHz) |S21| (dB) I=0, Q=0 I=0, Q=1 I=1, Q=0 I=1, Q=1 0.079dB The input (S 11 ) and output (S 22 ) reflection coefficients were also computed as part of these simulations and their magnitudes plotted separately in Figures 4.23 -15 -14 -13 -12 -11 -10 2.0 2.2 2.4 2.6 2.8 3.0 3.2 3.4 3.6 3.8 4.0 Frequency (GHz) |S11| (dB) I=0, Q=0 I=0, Q=1 I=1, Q=0 I=1, Q=1 -30 -25 -20 -15 -10 2.0 2.2 2.4 2.6 2.8 3.0 3.2 3.4 3.6 3.8 4.0 Frequency (GHz) |S22| (dB) I=0, Q=0 I=0, Q=1 I=1, Q=0 I=1, Q=1 In order to have more confidence in the circuit's performance after fabrication, simulations were performed on the layout of the modulator IC in Cadence Virtuoso, which is shown in Figure 4.25. The layout was first extracted with the parasitic capacitance between the various metal traces and other process layers included in it.\n\nThen a test bench (Figure 4.26) was set up to run the simulations on this extracted layout.\n\nThe same S-parameter simulation was run to assess the signal constellation, loss and reflection coefficients. The phase of the resulting transmission coefficient (S 21 ) from the input to the output for each of the four QPSK symbol values is plotted in Figure 4.27. As indicated on the plot at 2.4GHz, the phase differences between the outputs remain very close to the desired 90°, 180° and 270° (-90°), with a maximum phase error of only 0.53°.\n\nThe magnitude of this transmission coefficient is plotted on a similar graph in Figure 4.28, also indicating a low amplitude imbalance of 0.23dB at the same frequency. In addition, it is clear that the signal now exhibits a maximum loss of 6.2dB, which is again not excessive. The input (S 11 ) and output (S 22 ) reflection coefficients are also plotted separately in Figures 4.29 and 4.30. It is clear that the reflection coefficients are still quite low, with magnitudes lower than -10dB over the entire bandwidth. These simulations provide a good indication on how the fabricated IC will perform when tested.\n\nTo simulate the modulator's carrier rejection, a time-domain simulation was run with a 2.4GHz, -20dBm sinusoidal signal source for the carrier, and a square wave source for each of the I and Q digital signals. The same square wave parameters were set for both I and Q sources, with an amplitude level of 1.8V (V dd ) in the high state and 0V (ground) in the low state. The frequency of the square wave f MOD was also chosen to be 50MHz (time period T = 1/f MOD = 20ns) for a 100Mbps data rate. It is important to note that the relatively high frequency of 50MHz was necessary because of the speed and memory constraints of the computer system. The difficulty arises from the widely different frequencies of the carrier and digital modulation signals, which was discussed in detail in Chapter 3. The generated time-domain plot for the modulator's output voltage is shown in Figure 4.31 using an eye diagram to focus on the 180º phase traversals of the carrier signal. It can be seen that the zero crossings of the two signals roughly coincide at the same point in time, indicating a phase shift very close to 180º. The frequency spectrum of this modulated signal over 20 periods (400ns) is also illustrated in Figure 4.32. The spectrum matches the theoretical one discussed in Chapter 3, with a high degree of symmetry around the centre frequency and well-defined nulls at even-order harmonics. As depicted from the plot, the carrier at 2.4GHz is also well suppressed by more than 32dB relative to the main spectral lines at 2.4GHz ± 50MHz.  -100 -50 0 50 100 150 200 250 300 2.0 2.2 2.4 2.6 2.8 3.0 3.2 3.4 3.6 3.8 4.0 Frequency (GHz) Phase of S21 (Degrees) I=0, Q=0 I=0, Q=1 I=1, Q=0 I=1, Q=1 90.44°1 80.37°2 69.47° Chapter 4 S-Band Direct-Digital QPSK Modulator 102 -15 -10 -5 0 2.0 2.2 2.4 2.6 2.8 3.0 3.2 3.4 3.6 3.8 4.0 Frequency (GHz) |S21| (dB) I=0, Q=0 I=0, Q=1 I=1, Q=0 I=1, Q=1 0.23dB  2.0 2.2 2.4 2.6 2.8 3.0 3.2 3.4 3.6 3.8 4.0 Frequency (GHz) |S11| (dB) Figure 4.29: Input reflection coefficient S11 magnitude for modulator IC layout. -20 -19 -18 -17 -16 -15 -14 -13 -12 -11 -10 2.0 2.2 2.4 2.6 2.8 3.0 3.2 3.4 3.6 3.8 4.0 Frequency (GHz) |S22| (dB)   4.4 QPSK Modulator Test and Measurement The QPSK modulator was fabricated in a standard (six-metal, single-poly) 0.18µm CMOS process. A photograph of the IC is shown in Figure 4.33. It occupies a total die area of about 0.720 × 0.888 mm including test structures and bonding pads, but the active circuit area is only 0.505 × 0.610 mm. The circuit consumes less than 19mA of current from a 1.8V voltage supply, i.e. 34mW of power. To test the QPSK modulator IC, a direct on-wafer measurement was carried out using Cascade Microtech coplanar waveguide (CPW) probes and DC probes on a Wentworth probe station. An Anritsu signal generator (model MG3694A) and Agilent pulse data generator (model 81130A) were used to apply the input carrier signal and digital data signals respectively. To examine the output signal spectrum, the Agilent E4446A spectrum analyzer was used. Finally, a vector network analyzer (Agilent Chapter 4 S-Band Direct-Digital QPSK Modulator 105 8510C) was employed for all S-parameter measurements including QPSK signal constellations and reflection coefficients. Prior to the VNA measurements, a full twoport SOLT calibration was performed using a SUSS MicroTec calibration substrate. The first measurement performed was the signal constellation of the modulator with the I and Q data switches held at constant values corresponding to the four QPSK symbols (00, 10, 11, and 10). High (1.8V) and low (0V) voltage levels were applied to represent logic 1 and 0 respectively for the I and Q inputs depending on the constellation signal being measured. The magnitude of the transmission coefficient from the input to the output (S 21 ) in each of the four states is shown in Figure 4.34 from 2GHz to 3GHz. It is clear that the maximum loss exhibited at the centre frequency of 2.4GHz is about  -\n\n-1 0 2.0 2.1 2.2 2.3 2.4 2.5 2.6 2.7 2.8 2.9 3.0 Frequency (GHz) |S21| (dB) I=0, Q=0 I=1, Q=1 I=0, Q=1 I=1, Q=0 0.300dB Figure 4.34: Measured transmission coefficient S21 magnitude for all I and Q. Chapter 4 S-Band Direct-Digital QPSK Modulator 107 -50 0 50 100 150 200 250 300 2.0 2.1 2.2 2.3 2.4 2.5 2.6 2.7 2.8 2.9 3.0 Frequency (GHz) Phase of S21 (Degrees) I=0, Q=0 I=1, Q=1 I=0, Q=1 I=1, Q=0 91.42°1 80.69°2 68.99° Figure 4.35: Measured transmission coefficient S21 phase for all I and Q. -15 -14 -13 -12 -11 -10 -9 -8 -7 -6 -5 2.0 2.1 2.2 2.3 2.4 2.6 2.7 2.8 2.9 3.0 Frequency (GHz) |S11| (dB) Figure 4.36: Measured input reflection coefficient S11. -20 -19 -18 -17 -16 -15 2.0 2.1 2.2 2.3 2.4 2.6 2.7 2.8 2.9 3.0 Frequency (GHz) |S22| (dB) To measure the QPSK modulator's carrier rejection, the same square wave is applied to both I and Q data channels, with an amplitude level of 1.8V (V dd ) in the high state and 0V (ground) in the low state. The output of the IC is then connected directly to the spectrum analyzer. The frequency of the square wave f MOD is chosen to be 1MHz\n\n(time period T = 1/f MOD = 1µs) for a 2Mbps data rate per channel or a total data throughput of 2Mbps × 2 channels = 4Mbps. Figure 4.38 shows the resulting output signal spectrum with a centre (carrier) frequency of 2.4GHz, a frequency span of 50 MHz and resolution bandwidth of 390kHz. The spectrum shape matches the theoretical one discussed in Chapter 3, with a high degree of symmetry around the centre frequency and well-defined nulls at the even-order harmonics. As depicted from the plot, the carrier is well as the finite switching time of the NMOS switches, which allow both paths in a complimentary pair to be simultaneously on. Such intervals become more significant as the symbol period is reduced, possibly leading to the discrepancies seen at higher frequencies. As the transmitted information in real-world communication systems is most often random as opposed to periodic, pseudo-random binary sequences (PRBS) with a 9bit shift register were employed for the input I and Q data channels. The sequences were encoded in the non-return-to-zero (NRZ) format with rectangular pulses having an amplitude level of 0V (ground) in the low state and 1.8V (V dd ) in the high state. Their data rate was set to be 28Mbps (pulse width T = 1/f MOD ≈ 36ns) for a total data throughput of 28Mbps × 2 channels = 56Mbps. Finally, the output of the IC was directly connected to the spectrum analyzer.  Further tests were carried out to assess the modulator's performance at higher speeds. For data rates of 50 and 54Mbps per channel i.e. 100 and 108Mbps total, the measured output spectra of the modulator are shown in Figures 4.41    Table 4.1 below summarizes the measured characteristics of the S-band QPSK modulator. Table 4.1: Summary of measured characteristics of S-band QPSK modulator. Characteristic Results Active Area 0.505 × 0.610mm DC Power Consumption 34mW from 1.8V Modulation Accuracy Amplitude Error ≤ 0.3dB Phase Error ≤ 1.4° Insertion Loss < 5.5dB Return Loss Input: < -10dB Output: < -17dB Carrier Rejection > 32dB Data Throughput Nominal: 56Mbps Maximum: 200Mbps\n\nThe performance characteristics of our novel direct-digital QPSK modulators can now be evaluated against other work found in the literature. Table 4.2 below summarizes this work's performance in comparison with five other competitive direct-digital QPSK modulators: [23], [25], [26], [59] and [60], that were designed for similar applications within the carrier frequency range of 1GHz to 4GHz.\n\nTable 4.2: Comparison of the S-band QPSK modulator with other work. Characteristics Technology Area DC Power Accuracy (Errors) Data Rate [23] 0.5µm GaAs 2.2×2.4mm 2 600mW at 8V <0.8dB, <5° 4Mbps [25] 0.8µm GaAs 1.2×1.2mm 2 110mW at 3.1V 0.05dB, 1.1° 768Kbps [26] 18GHz Si-Bipolar 2.4×0.68mm 2 68mW at 2V 0.04dB, 1.6° 768Kbps [59] 0.35µm CMOS 0.85×0.9mm 2 188mW at 3.3V 0.09dB, 0.6° 15Mbps [60] 0.18µm CMOS 0.94×0.94mm 2 42mW at 1.8V Not Available 14Mbps This work 0.18µm CMOS 0.51×0.61mm 2 33mW at 1.8V <0.3dB, <1.4° 56Mbps From Table 4.2 above, it is clear that our S-band QPSK modulator is superior in terms of size, power consumption and data rate, making it more suitable for portable high-speed wireless devices. However, the modulation accuracy seems to be only average compared to other work. It is important to note that for [25], [26] and [59] the modulation accuracy was characterized using single sideband (SSB) modulation where 90° out-of-phase sinusoids are applied at the I and Q data inputs, with the relative level of the suppressed sideband at the output (Image Rejection Ratio or IRR) being a function of the phase and amplitude imbalance of the quadrature RF carriers. In effect, this only includes errors between two quadrature vectors in the QPSK constellation, and not all four QPSK vectors are taken into account as performed in this work and [23]. respectively. The measured insertion loss was also lower than 5.5dB while the input and output return loss were better than -10 and -17dB respectively. The supported data transmission rates exceeded 56Mbps towards a maximum of 200Mbps, and a high carrier rejection of more than 32dB was achieved. These results are in close agreement with our simulations, indicating good design and predictability.\n\nA few additional enhancements and feature extensions for the direct-digital QPSK modulators can be suggested at this point as future work. For instance, two or three stagger-tuned stages of the RC polyphase filter can be cascaded with their cut-off frequencies logarithmically spaced out to achieve an accurate 90° phase shift over a wide frequency range. Since the active CG-CS balun also has a wideband frequency response with low amplitude and phase imbalance, the QPSK modulator can be potentially used over a broad range of carrier frequencies for various wireless communication systems. In addition, tunable components such as voltage-controlled resistors are no longer necessary in this case to adjust the polyphase filter's performance after fabrication, eliminating the The proposed direct-digital QPSK modulator concept can also be extended for 8PSK modulation, which is used in some wireless communication technologies such as Enhanced General Packet Radio Service (EGPRS) to increase the spectrum efficiency for a higher data transmission rate or a narrower occupied bandwidth. In 8PSK modulation, the carrier phase takes on one of eight equally spaced values that are 45° apart depending on the binary value of three data bits. Therefore it can be implemented by adding a 45° phase shifter for example, along with additional 90° phase shifters, baluns and switches of course."
}